
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система управління супермаркетом</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            min-height: 100vh;
            padding: 100px 20px 20px 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            color: white;
            padding: 40px ;
           /* padding-top: 190px;*/
            text-align: center;
            /*position: relative;*/
            overflow: hidden;
            
        }

            /*.header::before {
                content: '';
                position: absolute;
                top: -50%;
                left: -50%;
                width: 200%;
                height: 200%;
                background: repeating-linear-gradient( 45deg, transparent, transparent 2px, rgba(255,255,255,0.05) 2px, rgba(255,255,255,0.05) 4px );
                animation: slide 20s linear infinite;
            }*/

        @keyframes slide {
            0% {
                transform: translateX(-50px);
            }

            100% {
                transform: translateX(50px);
            }
        }

        .header h1 {
            font-size: 2.5em;
          /*  margin: 10px;*/
           /* position: relative;*/
            z-index: 1;
           
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

            .section:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            }

            .section h3 {
                color: #1e3a8a;
                margin-bottom: 20px;
                border-bottom: 3px solid #3730a3;
                padding-bottom: 8px;
                font-size: 1.3em;
                display: flex;
                align-items: center;
                gap: 10px;
            }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.95em;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

            input:focus, select:focus, textarea:focus {
                outline: none;
                border-color: #3730a3;
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(30, 58, 138, 0.15);
            }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        button {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(30, 58, 138, 0.3);
            }

            button.delete {
                background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            }

                button.delete:hover {
                    box-shadow: 0 8px 25px rgba(229, 62, 62, 0.3);
                }

            button.update {
                background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            }

                button.update:hover {
                    box-shadow: 0 8px 25px rgba(237, 137, 54, 0.3);
                }

        .employees-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .employee-card {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

            .employee-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            }

            .employee-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 12px 35px rgba(0,0,0,0.1);
            }

            .employee-card h4 {
                color: #2d3748;
                margin-bottom: 15px;
                font-size: 1.2em;
                font-weight: 700;
            }

        .employee-info {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
        }

            .employee-info span {
                font-weight: 600;
                color: #4a5568;
                min-width: 120px;
            }

        .employee-value {
            color: #2d3748;
            text-align: right;
        }

        .response {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            font-size: 13px;
        }

        .success {
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
            border: 2px solid #9ae6b4;
            color: #22543d;
        }

        .error {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            border: 2px solid #fc8181;
            color: #742a2a;
        }

        .loading {
            background: linear-gradient(135deg, #fffbeb 0%, #fef5e7 100%);
            border: 2px solid #f6e05e;
            color: #744210;
        }

        .api-url {
            font-size: 12px;
            color: #718096;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            border-left: 4px solid #3730a3;
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.2);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e3a8a;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }




        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .section-separator {
            margin: 50px 0;
            padding: 30px;
            /* background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);*/
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            color: white;
            text-align: center;
            border-radius: 15px;
        }

            .section-separator h2 {
                font-size: 2em;
                margin-bottom: 10px;
            }

            .section-separator p {
                font-size: 1.1em;
            }

        .sales-card {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

            .sales-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(135deg, #059669 0%, #047857 100%);
            }

            .sales-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 12px 35px rgba(0,0,0,0.1);
            }

            .sales-card h4 {
                color: #047857;
                margin-bottom: 15px;
                font-size: 1.1em;
                font-weight: 700;
            }

        .sales-info {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
        }

            .sales-info span {
                font-weight: 600;
                color: #374151;
                min-width: 120px;
            }

        .sales-value {
            color: #111827;
            text-align: right;
            font-weight: 500;
        }

        .sales-amount {
            color: #059669;
            font-weight: bold;
            font-size: 1.1em;
        }

        .sales-date {
            color: #6b7280;
            font-size: 0.9em;
        }

        .analysis-card {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

            .analysis-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            }

            .analysis-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 12px 35px rgba(0,0,0,0.1);
            }

            .analysis-card h4 {
                color: #92400e;
                margin-bottom: 15px;
                font-size: 1.1em;
                font-weight: 700;
            }

        .date-range-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .sales-stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .sales-stat-card {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(5, 150, 105, 0.2);
        }

        .total-section {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            color: white;
            padding: 30px;
            margin: 40px 0;
            border-radius: 15px;
            text-align: center;
        }

            .total-section h2 {
                font-size: 2em;
                margin-bottom: 10px;
            }

        .filter-section {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #3730a3;
        }

            .filter-section h4 {
                color: #1e3a8a;
                margin-bottom: 15px;
                font-size: 1.1em;
            }

        .time-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

            .time-input input {
                flex: 1;
            }

            .time-input span {
                font-weight: 600;
                color: #4a5568;
                white-space: nowrap;
            }

        .procedure-card {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

            .procedure-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            }

            .procedure-card h4 {
                color: #4338ca;
                margin-bottom: 15px;
                font-size: 1.1em;
                font-weight: 700;
            }

        .working-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 10px;
        }

            .working-status.working {
                background: #d1fae5;
                color: #065f46;
            }

            .working-status.not-working {
                background: #fee2e2;
                color: #991b1b;
            }

        .sales-section-separator {
            margin: 50px 0;
            padding: 30px;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            color: white;
            text-align: center;
            border-radius: 15px;
        }

            .sales-section-separator h2 {
                font-size: 2em;
                margin-bottom: 10px;
            }

            .sales-section-separator p {
                font-size: 1.1em;
            }
        .head-section {
            position: fixed;
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            top:0;
            z-index: 9999;
            margin-left:-20px;
        }
            .head-menu{
                display: flex;
                width:100%;
                padding: 20px;
            }
        .head-item a {
            text-decoration: none;
            color: white;
            font-weight: 700;
            transition: all 0.3s ease;
            display: inline-block;
        }
                .head-item a:hover{
                    color:gainsboro;
                    transform:scale(1.05);
                }
                .head-list {
                    display: flex;
                    align-items: center;
                    justify-content: flex-start;
                    gap: 20px;
                    list-style-type: none;
                }
        .api-url {
            display: none;
        }

        .footer {
            padding: 20px;
            margin: 0;
            width: 100%;
            height: 40%;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            color: white;
            display: flex;
            margin: 30px -20px -20px -20px;
            justify-content: center;
        }
        .rights{
            text-align:center;
            font-weight:700;
        }
    </style>
</head>
<body>
    <header class="head-section">
        <nav class="head-menu">
            <ul class="head-list">
                <li class="head-item"><a href="#employees">Співробітники</a></li>
                <li class="head-item"><a href="#products">Товари</a></li>
                <li class="head-item"><a href="#sales">Продажі</a></li>
                <li class="head-item"><a href="#departments">Відділи</a></li>
            </ul>
        </nav>
    </header>
    <div class="container">
        <div class="header">
            <h1 id="employees">🏢 Система управління супермаркетом</h1>

        </div>

        <div class="content">
            <div class="stats-bar" id="statsBar" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number" id="totalEmployees">0</div>
                    <div class="stat-label">Всього співробітників</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalDepartments">0</div>
                    <div class="stat-label">Відділів</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgAge">0</div>
                    <div class="stat-label">Середній вік</div>
                </div>
            </div>

            <div class="section">
                <h3>📋 Всі співробітники</h3>
                <div class="api-url">GET /api/employees</div>
                <button onclick="getAllEmployees()">
                    <span id="loadAllSpinner" style="display: none;" class="loading-spinner"></span>
                    Завантажити всіх співробітників
                </button>
                <div id="employeesGrid" class="employees-grid"></div>
            </div>

            <div class="section">
                <h3>🔍 Пошук співробітника за ID</h3>
                <div class="api-url">GET /api/employees/{id}</div>
                <div class="form-group">
                    <label for="employeeId">ID співробітника:</label>
                    <select id="employeeId">
                        <option value="">Виберіть ID співробітника</option>
                    </select>
                </div>
                <button onclick="getEmployeeById()">Знайти співробітника</button>
                <div id="employeeByIdResponse" class="response" style="display: none;"></div>
                <div id="employeeByIdGrid" class="employees-grid"></div>
            </div>
            <div class="section">
                <h3>🏢 Співробітники по відділах</h3>
                <div class="api-url">GET /api/employees/department/{department}</div>
                <div class="form-group">
                    <label for="departmentName">Відділ:</label>
                    <select id="departmentName">
                        <option value="">Виберіть відділ</option>
                    </select>
                </div>
                <button onclick="getEmployeesByDepartment()">Показати співробітників відділу</button>
                <div id="departmentResponse" class="response" style="display: none;"></div>
                <div id="departmentGrid" class="employees-grid"></div>
            </div>




            <div class="section">
                <h3>🎯 Співробітники за посадою та досвідом роботи</h3>
                <div class="api-url">GET /api/employees/position/{jobTitleId}/experience?minExperience=0&maxExperience=100</div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="searchJobTitle">Посада:</label>
                        <select id="searchJobTitle">
                            <option value="">Виберіть посаду</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="minExperience">Мінімальний досвід (років):</label>
                        <input type="number" id="minExperience" min="0" max="50" value="0" required
                               onkeydown="return false"
                               onkeypress="return false"
                               onkeyup="return false"
                               onpaste="return false"
                               oninput="return false">
                    </div>
                    <div class="form-group">
                        <label for="maxExperience">Максимальний досвід (років):</label>
                        <input type="number" id="maxExperience" min="0" max="50" value="20" required
                               onkeydown="return false"
                               onkeypress="return false"
                               onkeyup="return false"
                               onpaste="return false"
                               oninput="return false">
                    </div>
                </div>
                <button onclick="getEmployeesByPositionAndExperience()">Знайти співробітників</button>
                <div id="positionExperienceResponse" class="response" style="display: none;"></div>
                <div id="positionExperienceGrid" class="employees-grid"></div>
            </div>



            <div class="section">
                <h3>➕ Додати нового співробітника</h3>
                <div class="api-url">POST /api/employees</div>
                <form id="createForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="createName">Ім'я: *</label>
                            <input type="text" id="createName" required>
                        </div>
                        <div class="form-group">
                            <label for="createLastName">Прізвище: *</label>
                            <input type="text" id="createLastName" required>
                        </div>
                        <div class="form-group">
                            <label for="createSurname">По батькові:</label>
                            <input type="text" id="createSurname">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="createGender">Стать: *</label>
                            <select id="createGender" required>
                                <option value="">Виберіть стать</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="createDateOfBirth">Дата народження: *</label>
                            <input type="date" id="createDateOfBirth" required>
                        </div>
                        <div class="form-group">
                            <label for="createPhoneNumber">Номер телефону (380XXXXXXXXX): *</label>
                            <input type="text" id="createPhoneNumber" placeholder="380501234567" pattern="380[0-9]{9}" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="createAddress">Адреса: *</label>
                            <input type="text" id="createAddress" required>
                        </div>
                        <div class="form-group">
                            <label for="createCity">Місто: *</label>
                            <input type="text" id="createCity" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="createDepartment">Відділ: *</label>
                            <select id="createDepartment" required>
                                <option value="">Виберіть відділ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="createJobTitle">Посада: *</label>
                            <select id="createJobTitle" required>
                                <option value="">Виберіть посаду</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="createExperienceYear">Досвід роботи (років): *</label>
                            <input type="number" id="createExperienceYear" min="0" "  required
                                   onkeydown="return false"
                                   onkeypress="return false"
                                   onkeyup="return false"
                                   onpaste="return false"
                                   oninput="return false">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="createYearOfEmployment">Дата прийняття на роботу: *</label>
                            <input type="date" id="createYearOfEmployment" required>
                        </div>
                    </div>
                    <button type="button" onclick="createEmployee()">Створити співробітника</button>
                </form>
                <div id="createResponse" class="response" style="display: none;"></div>
            </div>



            <div class="section">
                <h3>✏️ Редагувати співробітника</h3>
                <div class="api-url">PUT /api/employees/{id}</div>
                <div class="form-group">
                    <label for="updateId">ID співробітника для редагування:</label>
                    <select id="updateId" required>
                        <option value="">Виберіть ID співробітника</option>
                    </select>
                </div>
                <div style="margin-bottom: 20px;">
                    <button type="button" onclick="loadEmployeeForUpdate()">Завантажити дані</button>
                </div>
                <form id="updateForm" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateName">Ім'я:</label>
                            <input type="text" id="updateName" required>
                        </div>
                        <div class="form-group">
                            <label for="updateLastName">Прізвище:</label>
                            <input type="text" id="updateLastName" required>
                        </div>
                        <div class="form-group">
                            <label for="updateSurname">По батькові:</label>
                            <input type="text" id="updateSurname">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateGender">Стать:</label>
                            <select id="updateGender" required>
                                <option value="">Виберіть стать</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="updateDateOfBirth">Дата народження:</label>
                            <input type="date" id="updateDateOfBirth" required>
                        </div>
                        <div class="form-group">
                            <label for="updatePhoneNumber">Номер телефону:</label>
                            <input type="text" id="updatePhoneNumber" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateAddress">Адреса:</label>
                            <input type="text" id="updateAddress" required>
                        </div>
                        <div class="form-group">
                            <label for="updateCity">Місто:</label>
                            <input type="text" id="updateCity" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateDepartment">Відділ:</label>
                            <select id="updateDepartment" required>
                                <option value="">Виберіть відділ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="updateJobTitle">Посада:</label>
                            <select id="updateJobTitle" required>
                                <option value="">Виберіть посаду</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="updateExperienceYear">Досвід роботи:</label>
                            <input type="number" id="updateExperienceYear" min="0" max="60" required
                                   onkeydown="return false"
                                   onkeypress="return false"
                                   onkeyup="return false"
                                   onpaste="return false"
                                   oninput="return false">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="updateYearOfEmployment">Дата прийняття на роботу:</label>
                        <input type="date" id="updateYearOfEmployment" required>
                    </div>
                    <button type="button" class="update" onclick="updateEmployee()">Оновити дані</button>
                </form>
                <div id="updateResponse" class="response" style="display: none;"></div>
            </div>


            <div class="section">
                <h3>🗑️ Видалити співробітника</h3>
                <div class="api-url">DELETE /api/employees/{id}</div>
                <div class="form-group">
                    <label for="deleteId">ID співробітника для видалення:</label>
                    <select id="deleteId" required>
                        <option value="">Виберіть ID співробітника</option>
                    </select>
                </div>
                <button class="delete" onclick="deleteEmployee()">Видалити співробітника</button>
                <div id="deleteResponse" class="response" style="display: none;"></div>
            </div>


            <div class="section-separator">
                <h2 id="products">🛒 ТОВАРИ </h2>
                <p>Система керування товарами магазину</p>
            </div>



            <div class="stats-bar" id="goodsStatsBar" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number" id="totalGoods">0</div>
                    <div class="stat-label">Всього товарів</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="expiringGoods">0</div>
                    <div class="stat-label">З терміном придатності</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgTemperature">0°C</div>
                    <div class="stat-label">Середня температура</div>
                </div>
            </div>


            <div class="section">
                <h3>📦 Всі товари</h3>
                <div class="api-url">GET /api/goods</div>
                <button onclick="getAllGoods()">
                    <span id="loadAllGoodsSpinner" style="display: none;" class="loading-spinner"></span>
                    Завантажити всі товари
                </button>
                <div id="goodsGrid" class="employees-grid"></div>
            </div>


            <div class="section">
                <h3>🔍 Пошук товару за ID</h3>
                <div class="api-url">GET /api/goods/{id}</div>
                <div class="form-group">
                    <label for="goodsId">ID товару:</label>
                    <select id="goodsId">
                        <option value="">Виберіть ID товару</option>
                    </select>
                </div>
                <button onclick="getGoodsById()">Знайти товар</button>
                <div id="goodsByIdResponse" class="response" style="display: none;"></div>
                <div id="goodsByIdGrid" class="employees-grid"></div>
            </div>


            <div class="section">
                <h3>⏰ Товари з терміном придатності</h3>
                <div class="api-url">GET /api/goods/expiring</div>
                <button onclick="getExpiringGoods()">Показати товари з терміном придатності</button>
                <div id="expiringGoodsResponse" class="response" style="display: none;"></div>
                <div id="expiringGoodsGrid" class="employees-grid"></div>
            </div>


            <div class="section">
                <h3>♾️ Товари без терміну придатності</h3>
                <div class="api-url">GET /api/goods/non-expiring</div>
                <button onclick="getNonExpiringGoods()">Показати товари без терміну придатності</button>
                <div id="nonExpiringGoodsResponse" class="response" style="display: none;"></div>
                <div id="nonExpiringGoodsGrid" class="employees-grid"></div>
            </div>


            <div class="section">
                <h3>📊 Аналіз товарів у відділі</h3>
                <div class="api-url">GET /api/goods/department-analysis/{departmentName}</div>
                <div class="form-group">
                    <label for="analysisDepartmentName">Відділ для аналізу:</label>
                    <select id="analysisDepartmentName">
                        <option value="">Виберіть відділ</option>
                    </select>
                </div>
                <button onclick="getDepartmentAnalysis()">Провести аналіз відділу</button>
                <div id="departmentAnalysisResponse" class="response" style="display: none;"></div>
                <div id="departmentAnalysisGrid" class="employees-grid"></div>
            </div>


            <div class="section">
                <h3>➕ Додати новий товар</h3>
                <div class="api-url">POST /api/goods</div>
                <form id="createGoodsForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="createGoodsProductName">Назва товару: *</label>
                            <input type="text" id="createGoodsProductName" required>
                        </div>
                        <div class="form-group">
                            <label for="createGoodsManufacturer">Виробник: *</label>
                            <input type="text" id="createGoodsManufacturer" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="createGoodsDepartment">Відділ: *</label>
                            <select id="createGoodsDepartment" required>
                                <option value="">Виберіть відділ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="createGoodsCountry">Країна: *</label>
                            <select id="createGoodsCountry" required>
                                <option value="">Виберіть країну</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="createGoodsTemperature">Температура зберігання (°C): *</label>
                            <input type="number" id="createGoodsTemperature" min="-100" max="100" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="createGoodsIsExpiring">Має термін придатності: *</label>
                            <select id="createGoodsIsExpiring" required onchange="toggleGoodsTermField('create')">
                                <option value="">Виберіть</option>
                                <option value="true">Так</option>
                                <option value="false">Ні</option>
                            </select>
                        </div>
                        <div class="form-group" id="createGoodsTermGroup" style="display: none;">
                            <label for="createGoodsTerm">Термін зберігання (днів):</label>
                            <input type="number" id="createGoodsTerm" min="1" required
                                   onkeydown="return false"
                                   onkeypress="return false"
                                   onkeyup="return false"
                                   onpaste="return false"
                                   oninput="return false">
                        </div>
                    </div>
                    <button type="button" onclick="createGoods()">Створити товар</button>
                </form>
                <div id="createGoodsResponse" class="response" style="display: none;"></div>
            </div>


            <div class="section">
                <h3>✏️ Редагувати товар</h3>
                <div class="api-url">PUT /api/goods/{id}</div>
                <div class="form-group">
                    <label for="updateGoodsId">ID товару для редагування:</label>
                    <select id="updateGoodsId" required>
                        <option value="">Виберіть ID товару</option>
                    </select>
                </div>
                <div style="margin-bottom: 20px;">
                    <button type="button" onclick="loadGoodsForUpdate()">Завантажити дані</button>
                </div>
                <form id="updateGoodsForm" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateGoodsProductName">Назва товару:</label>
                            <input type="text" id="updateGoodsProductName" required>
                        </div>
                        <div class="form-group">
                            <label for="updateGoodsManufacturer">Виробник:</label>
                            <input type="text" id="updateGoodsManufacturer" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateGoodsDepartment">Відділ:</label>
                            <select id="updateGoodsDepartment" required>
                                <option value="">Виберіть відділ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="updateGoodsCountry">Країна:</label>
                            <select id="updateGoodsCountry" required>
                                <option value="">Виберіть країну</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateGoodsTemperature">Температура зберігання (°C):</label>
                            <input type="number" id="updateGoodsTemperature" min="-100" max="100" step="0.1" required>
                        </div>
                        <div class="form-group">
                            <label for="updateGoodsIsExpiring">Має термін придатності:</label>
                            <select id="updateGoodsIsExpiring" required onchange="toggleGoodsTermField('update')">
                                <option value="">Виберіть</option>
                                <option value="true">Так</option>
                                <option value="false">Ні</option>
                            </select>
                        </div>
                        <div class="form-group" id="updateGoodsTermGroup" style="display: none;">
                            <label for="updateGoodsTerm">Термін зберігання (днів):</label>
                            <input type="number" id="updateGoodsTerm" min="1" required
                                   onkeydown="return false"
                                   onkeypress="return false"
                                   onkeyup="return false"
                                   onpaste="return false"
                                   oninput="return false">
                        </div>
                    </div>
                    <button type="button" class="update" onclick="updateGoods()">Оновити товар</button>
                </form>
                <div id="updateGoodsResponse" class="response" style="display: none;"></div>
            </div>


            <div class="section">
                <h3>🗑️ Видалити товар</h3>
                <div class="api-url">DELETE /api/goods/{id}</div>
                <div class="form-group">
                    <label for="deleteGoodsId">ID товару для видалення:</label>
                    <select id="deleteGoodsId" required>
                        <option value="">Виберіть ID товару</option>
                    </select>
                </div>
                <button class="delete" onclick="deleteGoods()">Видалити товар</button>
                <div id="deleteGoodsResponse" class="response" style="display: none;"></div>
            </div>


            <div class="sales-section-separator">
                <h2 id="sales">💰 ПРОДАЖІ </h2>
                <p>Система обліку та аналізу продажів</p>
            </div>


            <div class="sales-stats-bar" id="salesStatsBar" style="display: none;">
                <div class="sales-stat-card">
                    <div class="stat-number" id="totalSales">0</div>
                    <div class="stat-label">Всього продажів</div>
                </div>
                <div class="sales-stat-card">
                    <div class="stat-number" id="totalSalesAmount">0 грн</div>
                    <div class="stat-label">Загальна сума</div>
                </div>
                <div class="sales-stat-card">
                    <div class="stat-number" id="avgSaleAmount">0 грн</div>
                    <div class="stat-label">Середня сума продажу</div>
                </div>
            </div>



            <div class="section">
                <h3>💰 Всі продажі</h3>
                <div class="api-url">GET /api/sales</div>
                <button onclick="getAllSales()">
                    <span id="loadAllSalesSpinner" style="display: none;" class="loading-spinner"></span>
                    Завантажити всі продажі
                </button>
                <div id="salesGrid" class="employees-grid"></div>
            </div>


            <div class="section">
                <h3>🔍 Пошук продажу за ID</h3>
                <div class="api-url">GET /api/sales/{id}</div>
                <div class="form-group">
                    <label for="salesId">ID продажу:</label>
                    <select id="salesId">
                        <option value="">Виберіть ID продажу</option>
                    </select>
                </div>
                <button onclick="getSalesById()">Знайти продаж</button>
                <div id="salesByIdResponse" class="response" style="display: none;"></div>
                <div id="salesByIdGrid" class="employees-grid"></div>
            </div>


            <div class="section">
                <h3>👤 Продажі за співробітником</h3>
                <div class="api-url">GET /api/sales/employee/{employeeId}</div>
                <div class="form-group">
                    <label for="salesEmployeeId">Співробітник:</label>
                    <select id="salesEmployeeId">
                        <option value="">Виберіть співробітника</option>
                    </select>
                </div>
                <button onclick="getSalesByEmployee()">Показати продажі співробітника</button>
                <div id="salesByEmployeeResponse" class="response" style="display: none;"></div>
                <div id="salesByEmployeeGrid" class="employees-grid"></div>
            </div>



            <div class="section">
                <h3>📦 Продажі за товаром</h3>
                <div class="api-url">GET /api/sales/product/{productId}</div>
                <div class="form-group">
                    <label for="salesProductId">Товар:</label>
                    <select id="salesProductId">
                        <option value="">Виберіть товар</option>
                    </select>
                </div>
                <button onclick="getSalesByProduct()">Показати продажі товару</button>
                <div id="salesByProductResponse" class="response" style="display: none;"></div>
                <div id="salesByProductGrid" class="employees-grid"></div>
            </div>



            <div class="section">
                <h3>📊 Статистика продажів за співробітниками</h3>
                <div class="api-url">GET /api/sales/analysis/employees</div>
                <button onclick="getEmployeeSalesAnalysis()">Провести аналіз продажів</button>
                <div id="employeeSalesAnalysisResponse" class="response" style="display: none;"></div>
                <div id="employeeSalesAnalysisGrid" class="employees-grid"></div>
            </div>



            <div class="section">
                <h3>📅 Аналіз продажів за період</h3>
                <div class="api-url">GET /api/sales/analysis/period?startDate=YYYY-MM-DD&endDate=YYYY-MM-DD</div>
                <div class="date-range-inputs">
                    <div class="form-group">
                        <label for="analysisStartDate">Дата початку:</label>
                        <input type="date" id="analysisStartDate">
                    </div>
                    <div class="form-group">
                        <label for="analysisEndDate">Дата закінчення:</label>
                        <input type="date" id="analysisEndDate">
                    </div>
                </div>
                <button onclick="getSalesByPeriod()">Провести аналіз за період</button>
                <div id="salesPeriodAnalysisResponse" class="response" style="display: none;"></div>
                <div id="salesPeriodAnalysisGrid" class="employees-grid"></div>
            </div>



            <div class="section">
                <h3>➕ Додати новий продаж</h3>
                <div class="api-url">POST /api/sales</div>
                <form id="createSalesForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="createSalesEmployee">Співробітник: *</label>
                            <select id="createSalesEmployee" required>
                                <option value="">Виберіть співробітника</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="createSalesProduct">Товар: *</label>
                            <select id="createSalesProduct" required>
                                <option value="">Виберіть товар</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="createSalesDate">Дата продажу: *</label>
                            <input type="datetime-local" id="createSalesDate" required>
                        </div>
                        <div class="form-group">
                            <label for="createSalesQuantity">Кількість: *</label>
                            <input type="number" id="createSalesQuantity" min="0.001" step="0.001" required>
                        </div>
                        <div class="form-group">
                            <label for="createSalesPrice">Ціна за одиницю (грн): *</label>
                            <input type="number" id="createSalesPrice" min="0.01" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Загальна сума: <span id="createSalesTotalAmount">0.00 грн</span></label>
                    </div>
                    <button type="button" onclick="createSales()">Створити продаж</button>
                </form>
                <div id="createSalesResponse" class="response" style="display: none;"></div>
            </div>


            <div class="section">
                <h3>✏️ Редагувати продаж</h3>
                <div class="api-url">PUT /api/sales/{id}</div>
                <div class="form-group">
                    <label for="updateSalesId">ID продажу для редагування:</label>
                    <select id="updateSalesId" required>
                        <option value="">Виберіть ID продажу</option>
                    </select>
                </div>
                <div style="margin-bottom: 20px;">
                    <button type="button" onclick="loadSalesForUpdate()">Завантажити дані</button>
                </div>
                <form id="updateSalesForm" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateSalesEmployee">Співробітник:</label>
                            <select id="updateSalesEmployee" required>
                                <option value="">Виберіть співробітника</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="updateSalesProduct">Товар:</label>
                            <select id="updateSalesProduct" required>
                                <option value="">Виберіть товар</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateSalesDate">Дата продажу:</label>
                            <input type="datetime-local" id="updateSalesDate" required>
                        </div>
                        <div class="form-group">
                            <label for="updateSalesQuantity">Кількість:</label>
                            <input type="number" id="updateSalesQuantity" min="0.001" step="0.001" required>
                        </div>
                        <div class="form-group">
                            <label for="updateSalesPrice">Ціна за одиницю (грн):</label>
                            <input type="number" id="updateSalesPrice" min="0.01" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Загальна сума: <span id="updateSalesTotalAmount">0.00 грн</span></label>
                    </div>
                    <button type="button" class="update" onclick="updateSales()">Оновити продаж</button>
                </form>
                <div id="updateSalesResponse" class="response" style="display: none;"></div>
            </div>



            <div class="section">
                <h3>🗑️ Видалити продаж</h3>
                <div class="api-url">DELETE /api/sales/{id}</div>
                <div class="form-group">
                    <label for="deleteSalesId">ID продажу для видалення:</label>
                    <select id="deleteSalesId" required>
                        <option value="">Виберіть ID продажу</option>
                    </select>
                </div>
                <button class="delete" onclick="deleteSales()">Видалити продаж</button>
                <div id="deleteSalesResponse" class="response" style="display: none;"></div>
            </div>




            <div class="section">
                <h3>🏪 Товари за відділом і країною</h3>
                <div class="api-url">GET /api/sales/products/department/{departmentId}?countryId={countryId}</div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="procedureDepartmentId">Відділ: *</label>
                        <select id="procedureDepartmentId" required>
                            <option value="">Виберіть відділ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="procedureCountryId">Країна (необов'язково):</label>
                        <select id="procedureCountryId">
                            <option value="">Всі країни</option>
                        </select>
                    </div>
                </div>
                <button onclick="getProductsByDepartmentAndCountry()">Знайти товари</button>
                <div id="procedureProductsResponse" class="response" style="display: none;"></div>
                <div id="procedureProductsGrid" class="employees-grid"></div>
            </div>



            <div class="section">
                <h3>🕐 Перевірка роботи відділу</h3>
                <div class="api-url">GET /api/sales/department/{departmentId}/working-status?checkTime=HH:mm</div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="workingStatusDepartmentId">Відділ: *</label>
                        <select id="workingStatusDepartmentId" required>
                            <option value="">Виберіть відділ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="checkTime">Час для перевірки: *</label>
                        <div class="time-input">
                            <input type="time" id="checkTime" required>
                            <span>(формат: ГГ:ХХ)</span>
                        </div>
                    </div>
                </div>
                <button onclick="checkDepartmentWorkingStatus()">Перевірити статус роботи</button>
                <div id="workingStatusResponse" class="response" style="display: none;"></div>
                <div id="workingStatusGrid" class="employees-grid"></div>
            </div>



            <div class="section-separator">
                <h2 id="departments">🏢 ВІДДІЛИ </h2>
                <p>Система управління відділами магазину</p>
            </div>


            <!--<div class="stats-bar" id="departmentsStatsBar" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number" id="totalDepartments">0</div>
                    <div class="stat-label">Всього відділів</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="salesDepartments">0</div>
                    <div class="stat-label">Торгових відділів</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgCounters">0</div>
                    <div class="stat-label">Середня кількість прилавків</div>
                </div>
            </div>-->
            <!-- Все отделы -->
            <div class="section">
                <h3>🏢 Всі відділи</h3>
                <div class="api-url">GET /api/departments</div>
                <button onclick="getAllDepartments()">
                    <span id="loadAllDepartmentsSpinner" style="display: none;" class="loading-spinner"></span>
                    Завантажити всі відділи
                </button>
                <div id="departmentsGrid" class="employees-grid"></div>
            </div>

            <!-- Редактирование отдела -->
            <div class="section">
                <h3>✏️ Редагувати відділ</h3>
                <div class="api-url">PUT /api/departments/{id}</div>
                <div class="form-group">
                    <label for="updateDepartmentId">Відділ для редагування:</label>
                    <select id="updateDepartmentId" required>
                        <option value="">Виберіть відділ</option>
                    </select>
                </div>
                <div style="margin-bottom: 20px;">
                    <button type="button" onclick="loadDepartmentForUpdate()">Завантажити дані</button>
                </div>
                <form id="updateDepartmentForm" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateDeptName">Назва відділу: *</label>
                            <input type="text" id="updateDeptName" required>
                        </div>
                        <div class="form-group">
                            <label for="updateLocationRow">Номер ряду: *</label>
                            <input type="number" id="updateLocationRow" min="0" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateSales">Наявність акцій: *</label>
                            <select id="updateSales" required>
                                <option value="">Виберіть</option>
                                <option value="true">Так</option>
                                <option value="false">Ні</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="updateCounters">Кількість прилавків: *</label>
                            <input type="number" id="updateCounters" min="0" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="updateStartTime">Час відкриття: *</label>
                            <input type="time" id="updateStartTime" required>
                        </div>
                        <div class="form-group">
                            <label for="updateEndTime">Час закриття: *</label>
                            <input type="time" id="updateEndTime" required>
                        </div>
                    </div>
                    <button type="button" class="update" onclick="updateDepartment()">Оновити відділ</button>
                </form>
                <div id="updateDepartmentResponse" class="response" style="display: none;"></div>
            </div>



        </div>
    </div>
    <footer class="footer">
        <span class="rights">@All rights are reserved by Valeriia Kupriian</span>
    </footer>

    <!--<script>
        const API_BASE = 'http://localhost:5109/api/employees';
        const GOODS_API_BASE = 'http://localhost:5109/api/goods';

        let genders = [];
        let departments = [];
        let positions = [];
        let allEmployees = [];
        let allGoods = [];
        let countries = [];


        window.addEventListener('load', async () => {
            setMaxDates();
            await loadReferenceData();
            await loadGoodsReferenceData();

        });


        async function loadReferenceData() {
            try {

                const gendersResponse = await fetch(`${API_BASE}/genders`);
                if (gendersResponse.ok) {
                    genders = await gendersResponse.json();
                    populateGenderSelects();
                }




                const departmentsResponse = await fetch(`${API_BASE}/departments`);
                if (departmentsResponse.ok) {
                    departments = await departmentsResponse.json();
                    populateDepartmentSelects();
                }


                const positionsResponse = await fetch(`${API_BASE}/positions`);
                if (positionsResponse.ok) {
                    positions = await positionsResponse.json();

                    populatePositionSelects();
                }
            } catch (error) {
                console.error('Error loading reference data:', error);
            }
        }

        function populateGenderSelects() {
            const selects = ['createGender', 'updateGender'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Виберіть стать</option>';
                genders.forEach(gender => {
                    select.innerHTML += `<option value="${gender.id}">${gender.genderName}</option>`;
                });
            });
        }

        function populateDepartmentSelects() {
            const selects = ['departmentName', 'createDepartment', 'updateDepartment'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const isForSearch = selectId === 'departmentName';
                select.innerHTML = '<option value="">Виберіть відділ</option>';

                departments.forEach(dept => {
                    const value = isForSearch ? dept.departmentName : dept.id;
                    select.innerHTML += `<option value="${value}">${dept.departmentName}</option>`;
                });
            });
        }

        function populatePositionSelects() {
            const selects = ['createJobTitle', 'updateJobTitle', 'searchJobTitle'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;

                const isForSearch = selectId === 'searchJobTitle';
                select.innerHTML = '<option value="">Виберіть посаду</option>';

                positions.forEach(position => {
                    const displayText = isForSearch
                        ? `${position.jobTitleName} (${position.salary} грн)`
                        : `${position.jobTitleName} (${position.salary} грн, ${position.workingTime} год)`;
                    select.innerHTML += `<option value="${position.id}">${displayText}</option>`;
                });
            });
        }

        function populateEmployeeIdSelects() {
            const selects = ['employeeId', 'updateId', 'deleteId'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Виберіть ID співробітника</option>';
                allEmployees.forEach(emp => {
                    select.innerHTML += `<option value="${emp.id}">${emp.id} - ${emp.fullName}</option>`;
                });
            });
        }




        function parseTriggerMessage(errorResponse) {
            let message = '';

            if (typeof errorResponse === 'string') {
                message = errorResponse;
            } else if (errorResponse.title || errorResponse.detail || errorResponse.message) {
                message = errorResponse.title || errorResponse.detail || errorResponse.message;
            } else {
                message = JSON.stringify(errorResponse);
            }



            const triggerMessages = {
                'Employee must be at least 18 years old!': '❌ Співробітник повинен бути не молодше 18 років!',
                'Work experience cannot exceed employee age minus 18 years!': '❌ Досвід роботи не може перевищувати вік мінус 18 років!',
                'Phone number must start with 380 and be 12 digits long!': '❌ Номер телефону повинен починатися з 380 і містити 12 цифр!',
                'City name must be specified and be at least 2 characters long!': '❌ Назва міста повинна бути вказана і містити мінімум 2 символи!',
                'The specified job title does not exist!': '❌ Вказана посада не існує!',
                'The specified department does not exist!': '❌ Вказаний відділ не існує!',
                'The specified gender does not exist!': '❌ Вказана стать не існує!',
                'Employee cannot have zero experience if employed more than 6 months ago!': '❌ Співробітник не може мати нульовий досвід, якщо працевлаштований більше 6 місяців тому!'
            };


            for (const [englishMsg, ukrainianMsg] of Object.entries(triggerMessages)) {
                if (message.includes(englishMsg)) {
                    return ukrainianMsg;
                }
            }


            return `⚠️ Помилка валідації: ${message}`;
        }


        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';

            let message = '';
            if (isError) {
                message = parseTriggerMessage(data);
                element.className = 'response error';
            } else {
                message = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
                element.className = 'response success';
            }

            element.textContent = message;
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'response success';
            element.textContent = `✅ ${message}`;
        }

        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'response loading';
            element.textContent = 'Завантаження...';
        }

        function updateStats(employees) {
            if (employees && employees.length > 0) {
                document.getElementById('totalEmployees').textContent = employees.length;
                document.getElementById('totalDepartments').textContent = new Set(employees.map(e => e.departmentName)).size;

                const avgAge = employees.reduce((sum, emp) => sum + emp.age, 0) / employees.length;
                document.getElementById('avgAge').textContent = Math.round(avgAge);

                document.getElementById('statsBar').style.display = 'grid';
            }
        }


        async function getAllEmployees() {
            const spinner = document.getElementById('loadAllSpinner');
            spinner.style.display = 'inline-block';

            try {
                const response = await fetch(API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allEmployees = data;
                    displayEmployeesGrid(data, 'employeesGrid');
                    updateStats(data);
                    populateEmployeeIdSelects();
                } else {


                    console.error('Error loading employees:', data);
                    document.getElementById('employeesGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка завантаження співробітників</p>';
                }
            } catch (error) {
                console.error('Error loading employees:', error);
                document.getElementById('employeesGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка підключення до сервера</p>';
            } finally {
                spinner.style.display = 'none';
            }
        }



        function displayEmployeesGrid(employees, gridId) {
            const grid = document.getElementById(gridId);
            if (employees.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">Співробітники не знайдені.</p>';
                return;
            }

            grid.innerHTML = employees.map(emp => `
                            <div class="employee-card">
                                <h4>${emp.fullName}</h4>
                                <div class="employee-info">
                                    <span>ID:</span>
                                    <div class="employee-value">${emp.id}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Стать:</span>
                                    <div class="employee-value">${emp.gender}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Вік:</span>
                                    <div class="employee-value">${emp.age} років</div>
                                </div>
                                <div class="employee-info">
                                    <span>Телефон:</span>
                                    <div class="employee-value">${emp.phoneNumber}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Місто:</span>
                                    <div class="employee-value">${emp.city}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Відділ:</span>
                                    <div class="employee-value">${emp.departmentName}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Посада:</span>
                                    <div class="employee-value">${emp.jobTitleName}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Зарплата:</span>
                                    <div class="employee-value">${emp.salary.toLocaleString()} грн</div>
                                </div>
                                <div class="employee-info">
                                    <span>Досвід:</span>
                                    <div class="employee-value">${emp.experienceYear} років</div>
                                </div>
                                <div class="employee-info">
                                    <span>Прийнятий:</span>
                                    <div class="employee-value">${new Date(emp.yearOfEmployment).toLocaleDateString('uk-UA')}</div>
                                </div>
                            </div>
                        `).join('');
        }


        async function getEmployeeById() {
            const id = document.getElementById('employeeId').value;
            if (!id) {
                showResponse('employeeByIdResponse', 'Будь ласка, виберіть ID співробітника', true);
                document.getElementById('employeeByIdGrid').innerHTML = '';
                return;
            }

            showLoading('employeeByIdResponse');
            try {
                const response = await fetch(`${API_BASE}/${id}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('employeeByIdResponse', `Знайдено співробітника з ID ${id}`);

                    displayEmployeesGrid([data], 'employeeByIdGrid');
                } else {
                    showResponse('employeeByIdResponse', data, true);
                    document.getElementById('employeeByIdGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('employeeByIdResponse', `Помилка: ${error.message}`, true);
                document.getElementById('employeeByIdGrid').innerHTML = '';
            }
        }

        async function getEmployeesByDepartment() {
            const department = document.getElementById('departmentName').value;
            if (!department) {
                showResponse('departmentResponse', 'Будь ласка, виберіть відділ', true);
                return;
            }

            showLoading('departmentResponse');
            try {
                const response = await fetch(`${API_BASE}/department/${encodeURIComponent(department)}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('departmentResponse', `Знайдено ${data.length} співробітників у відділі "${department}"`);
                    displayEmployeesGrid(data, 'departmentGrid');
                } else {
                    showResponse('departmentResponse', data, true);
                    document.getElementById('departmentGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('departmentResponse', `Помилка: ${error.message}`, true);
                document.getElementById('departmentGrid').innerHTML = '';
            }
        }


        async function getEmployeesByPositionAndExperience() {
            const jobTitleId = document.getElementById('searchJobTitle').value;
            const minExperience = document.getElementById('minExperience').value || 0;
            const maxExperience = document.getElementById('maxExperience').value || 100;

            if (!jobTitleId) {
                showResponse('positionExperienceResponse', 'Будь ласка, виберіть посаду', true);
                document.getElementById('positionExperienceGrid').innerHTML = '';
                return;
            }

            if (parseInt(minExperience) > parseInt(maxExperience)) {
                showResponse('positionExperienceResponse', 'Мінімальний досвід не може бути більшим за максимальний', true);
                document.getElementById('positionExperienceGrid').innerHTML = '';
                return;
            }

            showLoading('positionExperienceResponse');

            try {
                const url = `${API_BASE}/position/${jobTitleId}/experience?minExperience=${minExperience}&maxExperience=${maxExperience}`;
                const response = await fetch(url);
                const data = await response.json();

                if (response.ok) {
                    const selectedPosition = positions.find(p => p.id == jobTitleId);
                    const positionName = selectedPosition ? selectedPosition.jobTitleName : 'вибрана посада';

                    showResponse('positionExperienceResponse',
                        `Знайдено ${data.length} співробітників на посаді "${positionName}" з досвідом ${minExperience}-${maxExperience} років`);
                    displayEmployeesGrid(data, 'positionExperienceGrid');
                } else {
                    showResponse('positionExperienceResponse', data, true);
                    document.getElementById('positionExperienceGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('positionExperienceResponse', `Помилка: ${error.message}`, true);
                document.getElementById('positionExperienceGrid').innerHTML = '';
            }
        }


        async function createEmployee() {

            const name = document.getElementById('createName').value.trim();
            const lastName = document.getElementById('createLastName').value.trim();
            const surname = document.getElementById('createSurname').value.trim();
            const genderValue = document.getElementById('createGender').value;
            const dateOfBirth = document.getElementById('createDateOfBirth').value;
            const phoneNumber = document.getElementById('createPhoneNumber').value.trim();
            const address = document.getElementById('createAddress').value.trim();
            const city = document.getElementById('createCity').value.trim();
            const departmentValue = document.getElementById('createDepartment').value;
            const jobTitleValue = document.getElementById('createJobTitle').value;
            const experienceValue = document.getElementById('createExperienceYear').value;
            const yearOfEmployment = document.getElementById('createYearOfEmployment').value;


            if (!name || !lastName || !phoneNumber || !address || !city) {
                showResponse('createResponse', 'Будь ласка, заповніть всі обов\'язкові поля (позначені *)', true);
                return;
            }


            if (!genderValue || !departmentValue || !jobTitleValue || !experienceValue || !dateOfBirth || !yearOfEmployment) {
                showResponse('createResponse', 'Будь ласка, виберіть значення для всіх обов\'язкових полів', true);
                return;
            }


            const gender = parseInt(genderValue);
            const department = parseInt(departmentValue);
            const jobTitle = parseInt(jobTitleValue);
            const experienceYear = parseInt(experienceValue);


            if (isNaN(gender) || isNaN(department) || isNaN(jobTitle) || isNaN(experienceYear)) {
                showResponse('createResponse', 'Помилка: неправильні числові значення в полях', true);
                return;
            }


            const employeeData = {
                name: name,
                lastName: lastName,
                surname: surname || null,
                gender: gender,
                dateOfBirth: dateOfBirth,
                phoneNumber: phoneNumber,
                address: address,
                city: city,
                department: department,
                experienceYear: experienceYear,
                jobTitle: jobTitle,
                yearOfEmployment: yearOfEmployment
            };


            showLoading('createResponse');

            try {
                const response = await fetch(API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(employeeData)
                });

                if (response.ok) {
                    const data = await response.json();


                    const originalDate = new Date(yearOfEmployment);
                    const returnedDate = new Date(data.yearOfEmployment);

                    if (originalDate > new Date() && returnedDate.toDateString() === new Date().toDateString()) {
                        showSuccess('createResponse', 'Співробітника успішно створено! 📅 Дата прийняття на роботу була автоматично скорегована на сьогоднішню.');
                    } else {
                        showSuccess('createResponse', 'Співробітника успішно створено!');
                    }

                    document.getElementById('createForm').reset();
                    await getAllEmployees();
                } else {
                    const errorData = await response.json();
                    showResponse('createResponse', errorData, true);
                }
            } catch (error) {
                showResponse('createResponse', `Помилка підключення: ${error.message}`, true);
            }
        }


        async function loadEmployeeForUpdate() {
            const id = document.getElementById('updateId').value;
            if (!id) {
                showResponse('updateResponse', 'Будь ласка, виберіть ID співробітника', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/${id}`);
                if (response.ok) {
                    const employee = await response.json();

                    document.getElementById('updateName').value = employee.name;
                    document.getElementById('updateLastName').value = employee.lastName;
                    document.getElementById('updateSurname').value = employee.surname || '';


                    const gender = genders.find(g => g.genderName === employee.gender);
                    document.getElementById('updateGender').value = gender ? gender.id : '';

                    document.getElementById('updateDateOfBirth').value = employee.dateOfBirth.split('T')[0];
                    document.getElementById('updatePhoneNumber').value = employee.phoneNumber;
                    document.getElementById('updateAddress').value = employee.address;
                    document.getElementById('updateCity').value = employee.city;


                    const department = departments.find(d => d.departmentName === employee.departmentName);
                    document.getElementById('updateDepartment').value = department ? department.id : '';


                    const position = positions.find(p => p.jobTitleName === employee.jobTitleName);
                    document.getElementById('updateJobTitle').value = position ? position.id : '';

                    document.getElementById('updateExperienceYear').value = employee.experienceYear;
                    document.getElementById('updateYearOfEmployment').value = employee.yearOfEmployment.split('T')[0];


                    document.getElementById('updateForm').style.display = 'block';
                    showResponse('updateResponse', 'Дані співробітника завантажені успішно');
                } else {
                    const error = await response.json();
                    showResponse('updateResponse', error, true);
                }
            } catch (error) {
                showResponse('updateResponse', `Помилка: ${error.message}`, true);
            }
        }

        async function updateEmployee() {
            const id = document.getElementById('updateId').value;
            const employeeData = {
                name: document.getElementById('updateName').value.trim(),
                lastName: document.getElementById('updateLastName').value.trim(),
                surname: document.getElementById('updateSurname').value.trim() || null,
                gender: parseInt(document.getElementById('updateGender').value),
                dateOfBirth: document.getElementById('updateDateOfBirth').value,
                phoneNumber: document.getElementById('updatePhoneNumber').value.trim(),
                address: document.getElementById('updateAddress').value.trim(),
                city: document.getElementById('updateCity').value.trim(),
                department: parseInt(document.getElementById('updateDepartment').value),
                experienceYear: parseInt(document.getElementById('updateExperienceYear').value),
                jobTitle: parseInt(document.getElementById('updateJobTitle').value),
                yearOfEmployment: document.getElementById('updateYearOfEmployment').value
            };


            if (!employeeData.name || !employeeData.lastName || !employeeData.phoneNumber) {
                showResponse('updateResponse', 'Будь ласка, заповніть всі обов\'язкові поля', true);
                return;
            }

            showLoading('updateResponse');
            try {
                const originalDate = new Date(employeeData.yearOfEmployment);

                const response = await fetch(`${API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(employeeData)
                });

                if (response.ok) {
                    const data = await response.json();
                    await getAllEmployees();
                    document.getElementById('updateForm').style.display = 'none';


                    const returnedDate = new Date(data.yearOfEmployment);
                    if (originalDate > new Date() && returnedDate.toDateString() === new Date().toDateString()) {
                        showSuccess('updateResponse', 'Дані співробітника успішно оновлено! 📅 Дата прийняття на роботу була автоматично скорегована на сьогоднішню.');
                    } else {
                        showSuccess('updateResponse', 'Дані співробітника успішно оновлено!');
                    }
                } else {
                    const errorData = await response.json();
                    showResponse('updateResponse', errorData, true);
                }
            } catch (error) {
                showResponse('updateResponse', `Помилка підключення: ${error.message}`, true);
            }
        }


        async function deleteEmployee() {
            const id = document.getElementById('deleteId').value;
            if (!id) {
                showResponse('deleteResponse', 'Будь ласка, виберіть ID співробітника', true);
                return;
            }


            const employee = allEmployees.find(emp => emp.id == id);
            const employeeName = employee ? employee.fullName : `ID ${id}`;

            if (!confirm(`Ви впевнені, що хочете видалити співробітника ${employeeName}?`)) {
                return;
            }

            showLoading('deleteResponse');
            try {
                const response = await fetch(`${API_BASE}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showResponse('deleteResponse', `Співробітника ${employeeName} успішно видалено`);
                    document.getElementById('deleteId').value = '';
                    await getAllEmployees();
                } else {
                    const error = await response.json();
                    showResponse('deleteResponse', error, true);
                }
            } catch (error) {
                showResponse('deleteResponse', `Помилка: ${error.message}`, true);
            }
        }


        function setMaxDates() {
            const today = new Date().toISOString().split('T')[0];
            const maxBirthDate = new Date();
            maxBirthDate.setFullYear(maxBirthDate.getFullYear() - 18);
            const maxBirth = maxBirthDate.toISOString().split('T')[0];

            document.getElementById('createDateOfBirth').setAttribute('max', maxBirth);
            document.getElementById('updateDateOfBirth').setAttribute('max', maxBirth);
            document.getElementById('createYearOfEmployment').setAttribute('max', today);
            document.getElementById('updateYearOfEmployment').setAttribute('max', today);
        }


        async function loadGoodsReferenceData() {
            try {

                const countriesResponse = await fetch(`${GOODS_API_BASE}/countries`);
                if (countriesResponse.ok) {
                    countries = await countriesResponse.json();
                    populateCountrySelects();
                }

                populateGoodsDepartmentSelects();
            } catch (error) {
                console.error('Error loading goods reference data:', error);
            }
        }

        function populateCountrySelects() {
            const selects = ['createGoodsCountry', 'updateGoodsCountry'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Виберіть країну</option>';
                countries.forEach(country => {
                    select.innerHTML += `<option value="${country.id}">${country.countryName}</option>`;
                });
            });
        }

        function populateGoodsDepartmentSelects() {
            const selects = ['createGoodsDepartment', 'updateGoodsDepartment', 'analysisDepartmentName'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const isForAnalysis = selectId === 'analysisDepartmentName';
                select.innerHTML = '<option value="">Виберіть відділ</option>';

                departments.forEach(dept => {
                    const value = isForAnalysis ? dept.departmentName : dept.id;
                    select.innerHTML += `<option value="${value}">${dept.departmentName}</option>`;
                });
            });
        }

        function populateGoodsIdSelects() {
            const selects = ['goodsId', 'updateGoodsId', 'deleteGoodsId'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Виберіть ID товару</option>';
                allGoods.forEach(goods => {
                    select.innerHTML += `<option value="${goods.id}">${goods.id} - ${goods.productName}</option>`;
                });
            });
        }

        function toggleGoodsTermField(prefix) {
            const isExpiringSelect = document.getElementById(`${prefix}GoodsIsExpiring`);
            const termGroup = document.getElementById(`${prefix}GoodsTermGroup`);
            const termInput = document.getElementById(`${prefix}GoodsTerm`);

            if (isExpiringSelect.value === 'true') {
                termGroup.style.display = 'block';

            } else {
                termGroup.style.display = 'none';
                termInput.removeAttribute('required');
                termInput.value = '';
            }
        }


        async function getAllGoods() {
            const spinner = document.getElementById('loadAllGoodsSpinner');
            spinner.style.display = 'inline-block';

            try {
                const response = await fetch(GOODS_API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allGoods = data;
                    displayGoodsGrid(data, 'goodsGrid');
                    updateGoodsStats(data);
                    populateGoodsIdSelects();
                } else {
                    console.error('Error loading goods:', data);
                    document.getElementById('goodsGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка завантаження товарів</p>';
                }
            } catch (error) {
                console.error('Error loading goods:', error);
                document.getElementById('goodsGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка підключення до сервера</p>';
            } finally {
                spinner.style.display = 'none';
            }
        }

        function displayGoodsGrid(goods, gridId) {
            const grid = document.getElementById(gridId);
            if (goods.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">Товари не знайдені.</p>';
                return;
            }

            grid.innerHTML = goods.map(item => `
                    <div class="employee-card">
                        <h4>${item.productName}</h4>
                        <div class="employee-info">
                            <span>ID:</span>
                            <div class="employee-value">${item.id}</div>
                        </div>
                        <div class="employee-info">
                            <span>Виробник:</span>
                            <div class="employee-value">${item.manufacturer}</div>
                        </div>
                        <div class="employee-info">
                            <span>Відділ:</span>
                            <div class="employee-value">${item.departmentName}</div>
                        </div>
                        <div class="employee-info">
                            <span>Країна:</span>
                            <div class="employee-value">${item.countryName}</div>
                        </div>
                        <div class="employee-info">
                            <span>Температура:</span>
                            <div class="employee-value">${item.temperatureDisplay}</div>
                        </div>
                        <div class="employee-info">
                            <span>Термін придатності:</span>
                            <div class="employee-value">${item.expirationStatus}</div>
                        </div>
                    </div>
                `).join('');
        }

        function updateGoodsStats(goods) {
            if (goods && goods.length > 0) {
                const expiringCount = goods.filter(g => g.is_Expiring).length;
                const avgTemp = goods.reduce((sum, g) => sum + g.conditions_Temperature, 0) / goods.length;

                document.getElementById('totalGoods').textContent = goods.length;
                document.getElementById('expiringGoods').textContent = expiringCount;
                document.getElementById('avgTemperature').textContent = avgTemp.toFixed(1) + '°C';

                document.getElementById('goodsStatsBar').style.display = 'grid';
            }
        }


        async function getGoodsById() {
            const id = document.getElementById('goodsId').value;
            if (!id) {
                showResponse('goodsByIdResponse', 'Будь ласка, виберіть ID товару', true);
                document.getElementById('goodsByIdGrid').innerHTML = '';
                return;
            }

            showLoading('goodsByIdResponse');
            try {
                const response = await fetch(`${GOODS_API_BASE}/${id}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('goodsByIdResponse', `Знайдено товар з ID ${id}`);
                    displayGoodsGrid([data], 'goodsByIdGrid');
                } else {
                    showResponse('goodsByIdResponse', data, true);
                    document.getElementById('goodsByIdGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('goodsByIdResponse', `Помилка: ${error.message}`, true);
                document.getElementById('goodsByIdGrid').innerHTML = '';
            }
        }

        async function getExpiringGoods() {
            showLoading('expiringGoodsResponse');
            try {
                const response = await fetch(`${GOODS_API_BASE}/expiring`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('expiringGoodsResponse', `Знайдено ${data.length} товарів з терміном придатності`);
                    displayGoodsGrid(data, 'expiringGoodsGrid');
                } else {
                    showResponse('expiringGoodsResponse', data, true);
                    document.getElementById('expiringGoodsGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('expiringGoodsResponse', `Помилка: ${error.message}`, true);
                document.getElementById('expiringGoodsGrid').innerHTML = '';
            }
        }

        async function getNonExpiringGoods() {
            showLoading('nonExpiringGoodsResponse');
            try {
                const response = await fetch(`${GOODS_API_BASE}/non-expiring`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('nonExpiringGoodsResponse', `Знайдено ${data.length} товарів без терміну придатності`);
                    displayGoodsGrid(data, 'nonExpiringGoodsGrid');
                } else {
                    showResponse('nonExpiringGoodsResponse', data, true);
                    document.getElementById('nonExpiringGoodsGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('nonExpiringGoodsResponse', `Помилка: ${error.message}`, true);
                document.getElementById('nonExpiringGoodsGrid').innerHTML = '';
            }
        }


        async function getDepartmentAnalysis() {
            const departmentName = document.getElementById('analysisDepartmentName').value;
            if (!departmentName) {
                showResponse('departmentAnalysisResponse', 'Будь ласка, виберіть відділ', true);
                document.getElementById('departmentAnalysisGrid').innerHTML = '';
                return;
            }

            showLoading('departmentAnalysisResponse');
            try {
                const response = await fetch(`${GOODS_API_BASE}/department-analysis/${encodeURIComponent(departmentName)}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('departmentAnalysisResponse', data.summary);


                    const analysisHtml = `
                            <div class="employee-card" style="background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%); color: white;">
                                <h4 style="color: white;">📊 Аналіз відділу "${data.departmentName}"</h4>
                                <div class="employee-info" style="color: rgba(255,255,255,0.9);">
                                    <span style="color: white;">Всього товарів:</span>
                                    <div class="employee-value" style="color: white; font-weight: bold;">${data.productCount}</div>
                                </div>
                                <div class="employee-info" style="color: rgba(255,255,255,0.9);">
                                    <span style="color: white;">З терміном придатності:</span>
                                    <div class="employee-value" style="color: white; font-weight: bold;">${data.expiringProductCount}</div>
                                </div>
                                <div class="employee-info" style="color: rgba(255,255,255,0.9);">
                                    <span style="color: white;">Середня температура:</span>
                                    <div class="employee-value" style="color: white; font-weight: bold;">${data.avgStorageTemp.toFixed(1)}°C</div>
                                </div>
                                <div class="employee-info" style="color: rgba(255,255,255,0.9);">
                                    <span style="color: white;">Макс. термін приданості:</span>
                                    <div class="employee-value" style="color: white; font-weight: bold;">${data.maxTermDays || 'Н/Д'} днів</div>
                                </div>
                            </div>
                        `;
                    document.getElementById('departmentAnalysisGrid').innerHTML = analysisHtml;
                } else {
                    showResponse('departmentAnalysisResponse', data, true);
                    document.getElementById('departmentAnalysisGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('departmentAnalysisResponse', `Помилка: ${error.message}`, true);
                document.getElementById('departmentAnalysisGrid').innerHTML = '';
            }
        }


        function parseGoodsTriggerMessage(errorResponse) {
            let message = '';

            if (typeof errorResponse === 'string') {
                message = errorResponse;
            } else if (errorResponse.title || errorResponse.detail || errorResponse.message) {
                message = errorResponse.title || errorResponse.detail || errorResponse.message;
            } else {
                message = JSON.stringify(errorResponse);
            }


            const goodsTriggerMessages = {
                'Temperature must be between -100 and 100 degrees!': '❌ Температура повинна бути від -100 до 100 градусів!',
                'Term must be positive when Is_Expiring is true!': '❌ Термін повинен бути позитивним, коли товар має термін годності!',
                'Term cannot be specified when Is_Expiring is false!': '❌ Термін не може бути вказаний, коли товар не має терміну годності!',
                'The specified department does not exist!': '❌ Вказаний відділ не існує!',
                'The specified country does not exist!': '❌ Вказана країна не існує!'
            };


            for (const [englishMsg, ukrainianMsg] of Object.entries(goodsTriggerMessages)) {
                if (message.includes(englishMsg)) {
                    return ukrainianMsg;
                }
            }

            return `⚠️ Помилка валідації товару: ${message}`;
        }

        async function createGoods() {
            const productName = document.getElementById('createGoodsProductName').value.trim();
            const manufacturer = document.getElementById('createGoodsManufacturer').value.trim();
            const departmentValue = document.getElementById('createGoodsDepartment').value;
            const countryValue = document.getElementById('createGoodsCountry').value;
            const temperatureValue = document.getElementById('createGoodsTemperature').value;
            const isExpiringValue = document.getElementById('createGoodsIsExpiring').value;
            const termValue = document.getElementById('createGoodsTerm').value;


            if (!productName || !manufacturer || !departmentValue || !countryValue ||
                !temperatureValue || !isExpiringValue) {
                showResponse('createGoodsResponse', 'Будь ласка, заповніть всі обов\'язкові поля (позначені *)', true);
                return;
            }

            const department = parseInt(departmentValue);
            const country = parseInt(countryValue);
            const temperature = parseFloat(temperatureValue);
            const isExpiring = isExpiringValue === 'true';
            const term = termValue ? parseInt(termValue) : null;


            if (isNaN(department) || isNaN(country) || isNaN(temperature)) {
                showResponse('createGoodsResponse', 'Помилка: неправильні числові значення в полях', true);
                return;
            }


            const goodsData = {
                productName: productName,
                manufacturer: manufacturer,
                department: department,
                country: country,
                conditions_Temperature: temperature,
                is_Expiring: isExpiring,
                term: isExpiring ? term : null
            };

            showLoading('createGoodsResponse');

            try {
                const response = await fetch(GOODS_API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(goodsData)
                });

                if (response.ok) {
                    const data = await response.json();


                    const originalTerm = goodsData.term;
                    const returnedTerm = data.term;

                    if (isExpiring && !originalTerm && returnedTerm) {
                        showSuccess('createGoodsResponse',
                            `Товар успішно створено! 📅 Термін зберігання був автоматично встановлений на ${returnedTerm} днів згідно з правилами відділу.`);
                    } else {
                        showSuccess('createGoodsResponse', 'Товар успішно створено!');
                    }

                    document.getElementById('createGoodsForm').reset();
                    toggleGoodsTermField('create');
                    await getAllGoods();
                } else {
                    const errorData = await response.json();
                    const translatedMessage = parseGoodsTriggerMessage(errorData);
                    showResponse('createGoodsResponse', translatedMessage, true);
                }
            } catch (error) {
                showResponse('createGoodsResponse', `Помилка підключення: ${error.message}`, true);
            }
        }


        async function loadGoodsForUpdate() {
            const id = document.getElementById('updateGoodsId').value;
            if (!id) {
                showResponse('updateGoodsResponse', 'Будь ласка, виберіть ID товару', true);
                return;
            }

            try {
                const response = await fetch(`${GOODS_API_BASE}/${id}`);
                if (response.ok) {
                    const goods = await response.json();


                    document.getElementById('updateGoodsProductName').value = goods.productName;
                    document.getElementById('updateGoodsManufacturer').value = goods.manufacturer;


                    const department = departments.find(d => d.departmentName === goods.departmentName);
                    document.getElementById('updateGoodsDepartment').value = department ? department.id : '';

                    const country = countries.find(c => c.countryName === goods.countryName);
                    document.getElementById('updateGoodsCountry').value = country ? country.id : '';

                    document.getElementById('updateGoodsTemperature').value = goods.conditions_Temperature;
                    document.getElementById('updateGoodsIsExpiring').value = goods.is_Expiring.toString();
                    document.getElementById('updateGoodsTerm').value = goods.term || '';




                    toggleGoodsTermField('update');


                    document.getElementById('updateGoodsForm').style.display = 'block';
                    showResponse('updateGoodsResponse', 'Дані товару завантажені успішно');
                } else {
                    const error = await response.json();
                    showResponse('updateGoodsResponse', error, true);
                }
            } catch (error) {
                showResponse('updateGoodsResponse', `Помилка: ${error.message}`, true);
            }
        }


        async function updateGoods() {
            const id = document.getElementById('updateGoodsId').value;
            const productName = document.getElementById('updateGoodsProductName').value.trim();
            const manufacturer = document.getElementById('updateGoodsManufacturer').value.trim();
            const departmentValue = document.getElementById('updateGoodsDepartment').value;
            const countryValue = document.getElementById('updateGoodsCountry').value;
            const temperatureValue = document.getElementById('updateGoodsTemperature').value;
            const isExpiringValue = document.getElementById('updateGoodsIsExpiring').value;
            const termValue = document.getElementById('updateGoodsTerm').value;


            if (!productName || !manufacturer || !departmentValue || !countryValue ||
                !temperatureValue || !isExpiringValue) {
                showResponse('updateGoodsResponse', 'Будь ласка, заповніть всі обов\'язкові поля', true);
                return;
            }

            const department = parseInt(departmentValue);
            const country = parseInt(countryValue);
            const temperature = parseFloat(temperatureValue);
            const isExpiring = isExpiringValue === 'true';
            const term = termValue ? parseInt(termValue) : null;

            if (isNaN(department) || isNaN(country) || isNaN(temperature)) {
                showResponse('updateGoodsResponse', 'Помилка: неправильні числові значення в полях', true);
                return;
            }




            const goodsData = {
                productName: productName,
                manufacturer: manufacturer,
                department: department,
                country: country,
                conditions_Temperature: temperature,
                is_Expiring: isExpiring,
                term: isExpiring ? term : null
            };

            showLoading('updateGoodsResponse');

            try {
                const originalTerm = goodsData.term;

                const response = await fetch(`${GOODS_API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(goodsData)
                });

                if (response.ok) {
                    const data = await response.json();
                    await getAllGoods();
                    document.getElementById('updateGoodsForm').style.display = 'none';

                    const returnedTerm = data.term;
                    if (isExpiring && !originalTerm && returnedTerm) {
                        showSuccess('updateGoodsResponse',
                            `Дані товару успішно оновлено! 📅 Термін зберігання був автоматично встановлений на ${returnedTerm} днів згідно з правилами відділу.`);
                    } else {
                        showSuccess('updateGoodsResponse', 'Дані товару успішно оновлено!');
                    }
                } else {
                    const errorData = await response.json();
                    const translatedMessage = parseGoodsTriggerMessage(errorData);
                    showResponse('updateGoodsResponse', translatedMessage, true);
                }
            } catch (error) {
                showResponse('updateGoodsResponse', `Помилка підключення: ${error.message}`, true);
            }
        }


        async function deleteGoods() {
            const id = document.getElementById('deleteGoodsId').value;
            if (!id) {
                showResponse('deleteGoodsResponse', 'Будь ласка, виберіть ID товару', true);
                return;
            }


            const goods = allGoods.find(g => g.id == id);
            const goodsName = goods ? goods.productName : `ID ${id}`;

            if (!confirm(`Ви впевнені, що хочете видалити товар "${goodsName}"?`)) {
                return;
            }

            showLoading('deleteGoodsResponse');
            try {
                const response = await fetch(`${GOODS_API_BASE}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showResponse('deleteGoodsResponse', `Товар "${goodsName}" успішно видалено`);
                    document.getElementById('deleteGoodsId').value = '';
                    await getAllGoods();
                } else {
                    const error = await response.json();
                    showResponse('deleteGoodsResponse', error, true);
                }
            } catch (error) {
                showResponse('deleteGoodsResponse', `Помилка: ${error.message}`, true);
            }
        }



        const SALES_API_BASE = 'http://localhost:5109/api/sales';

        let allSales = [];


        window.addEventListener('load', async () => {
            setMaxDates();
            await loadReferenceData();
            await loadGoodsReferenceData();
            setMaxSalesDate();
        });

        function setMaxSalesDate() {
            const now = new Date();
            const today = now.toISOString().slice(0, 16);

            document.getElementById('createSalesDate').setAttribute('max', today);
            document.getElementById('updateSalesDate').setAttribute('max', today);


            document.getElementById('createSalesDate').value = today;

            const todayDate = now.toISOString().split('T')[0];
            const monthAgo = new Date(now.setMonth(now.getMonth() - 1)).toISOString().split('T')[0];

            document.getElementById('analysisStartDate').value = monthAgo;
            document.getElementById('analysisEndDate').value = todayDate;
            document.getElementById('analysisEndDate').setAttribute('max', todayDate);
        }

        function populateSalesSelects() {

            const employeeSelects = ['createSalesEmployee', 'updateSalesEmployee', 'salesEmployeeId'];
            employeeSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;

                select.innerHTML = '<option value="">Виберіть співробітника</option>';
                allEmployees.forEach(emp => {
                    select.innerHTML += `<option value="${emp.id}">${emp.fullName} (${emp.departmentName})</option>`;
                });
            });




            const productSelects = ['createSalesProduct', 'updateSalesProduct', 'salesProductId'];
            productSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;

                select.innerHTML = '<option value="">Виберіть товар</option>';
                allGoods.forEach(goods => {
                    select.innerHTML += `<option value="${goods.id}">${goods.productName} (${goods.departmentName})</option>`;
                });
            });


            const deptSelects = ['procedureDepartmentId', 'workingStatusDepartmentId'];
            deptSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;

                select.innerHTML = '<option value="">Виберіть відділ</option>';
                departments.forEach(dept => {
                    select.innerHTML += `<option value="${dept.id}">${dept.departmentName}</option>`;
                });
            });


            const countrySelect = document.getElementById('procedureCountryId');
            if (countrySelect) {
                countrySelect.innerHTML = '<option value="">Всі країни</option>';
                countries.forEach(country => {
                    countrySelect.innerHTML += `<option value="${country.id}">${country.countryName}</option>`;
                });
            }
        }

        function populateSalesIdSelects() {
            const selects = ['salesId', 'updateSalesId', 'deleteSalesId'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;

                select.innerHTML = '<option value="">Виберіть ID продажу</option>';
                allSales.forEach(sale => {
                    const shortInfo = `${sale.employeeName} - ${sale.productName}`;
                    select.innerHTML += `<option value="${sale.id}">${sale.id} - ${shortInfo}</option>`;
                });
            });
        }


        async function getAllEmployees() {
            const spinner = document.getElementById('loadAllSpinner');
            spinner.style.display = 'inline-block';

            try {
                const response = await fetch(API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allEmployees = data;
                    displayEmployeesGrid(data, 'employeesGrid');
                    updateStats(data);
                    populateEmployeeIdSelects();
                    populateSalesSelects();
                } else {
                    console.error('Error loading employees:', data);
                    document.getElementById('employeesGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка завантаження співробітників</p>';
                }
            } catch (error) {
                console.error('Error loading employees:', error);
                document.getElementById('employeesGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка підключення до сервера</p>';
            } finally {
                spinner.style.display = 'none';
            }
        }



        async function getAllGoods() {
            const spinner = document.getElementById('loadAllGoodsSpinner');
            spinner.style.display = 'inline-block';

            try {
                const response = await fetch(GOODS_API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allGoods = data;
                    displayGoodsGrid(data, 'goodsGrid');
                    updateGoodsStats(data);
                    populateGoodsIdSelects();
                    populateSalesSelects();
                } else {
                    console.error('Error loading goods:', data);
                    document.getElementById('goodsGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка завантаження товарів</p>';
                }
            } catch (error) {
                console.error('Error loading goods:', error);
                document.getElementById('goodsGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка підключення до сервера</p>';
            } finally {
                spinner.style.display = 'none';
            }
        }

        function parseSalesTriggerMessage(errorResponse) {
            let message = '';

            if (typeof errorResponse === 'string') {
                message = errorResponse;
            } else if (errorResponse.title || errorResponse.detail || errorResponse.message) {
                message = errorResponse.title || errorResponse.detail || errorResponse.message;
            } else {
                message = JSON.stringify(errorResponse);
            }

            const salesTriggerMessages = {
                'Quantity of sold products must be greater than zero!': '❌ Кількість проданих товарів повинна бути більше нуля!',
                'Product price must be greater than zero!': '❌ Ціна товару повинна бути більше нуля!',
                'Sale date cannot be in the future!': '❌ Дата продажу не може бути в майбутньому!',
                'Referenced employee does not exist!': '❌ Вказаний співробітник не існує!',
                'Referenced product does not exist!': '❌ Вказаний товар не існує!',
                'Employee can only sell products from their own department!': '❌ Співробітник може продавати тільки товари зі свого відділу!',
                'Product price must be between 0.01 and 999999.99!': '❌ Ціна товару повинна бути від 0.01 до 999999.99!',
                'Quantity cannot exceed 10000 units per sale!': '❌ Кількість не може перевищувати 10000 одиниць за продаж!'
            };

            for (const [englishMsg, ukrainianMsg] of Object.entries(salesTriggerMessages)) {
                if (message.includes(englishMsg)) {
                    return ukrainianMsg;
                }
            }

            return `⚠️ Помилка валідації продажу: ${message}`;
        }


        function displaySalesGrid(sales, gridId) {
            const grid = document.getElementById(gridId);
            if (sales.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">Продажі не знайдені.</p>';
                return;
            }

            grid.innerHTML = sales.map(sale => `
        <div class="sales-card">
            <h4>Продаж #${sale.id}</h4>
            <div class="sales-info">
                <span>Співробітник:</span>
                <div class="sales-value">${sale.employeeFullName}</div>
            </div>
            <div class="sales-info">
                <span>Товар:</span>
                <div class="sales-value">${sale.productName}</div>
            </div>
            <div class="sales-info">
                <span>Відділ:</span>
                <div class="sales-value">${sale.departmentName}</div>
            </div>
            <div class="sales-info">
                <span>Дата:</span>
                <div class="sales-value sales-date">${sale.formattedDate}</div>
            </div>
            <div class="sales-info">
                <span>Кількість:</span>
                <div class="sales-value">${sale.formattedQuantity}</div>
            </div>
            <div class="sales-info">
                <span>Ціна:</span>
                <div class="sales-value">${sale.formattedPrice}</div>
            </div>
            <div class="sales-info">
                <span>Сума:</span>
                <div class="sales-value sales-amount">${sale.formattedTotal}</div>
            </div>
        </div>
    `).join('');
        }

        function updateSalesStats(sales) {
            if (sales && sales.length > 0) {
                const totalAmount = sales.reduce((sum, sale) => sum + sale.total, 0);
                const avgAmount = totalAmount / sales.length;

                document.getElementById('totalSales').textContent = sales.length;
                document.getElementById('totalSalesAmount').textContent = totalAmount.toLocaleString('uk-UA', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }) + ' грн';
                document.getElementById('avgSaleAmount').textContent = avgAmount.toLocaleString('uk-UA', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }) + ' грн';

                document.getElementById('salesStatsBar').style.display = 'grid';
            }
        }


        function calculateSalesTotal(prefix) {
            const quantityInput = document.getElementById(`${prefix}SalesQuantity`);
            const priceInput = document.getElementById(`${prefix}SalesPrice`);
            const totalSpan = document.getElementById(`${prefix}SalesTotalAmount`);

            const quantity = parseFloat(quantityInput.value) || 0;
            const price = parseFloat(priceInput.value) || 0;
            const total = quantity * price;

            totalSpan.textContent = total.toLocaleString('uk-UA', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }) + ' грн';
        }


        document.addEventListener('DOMContentLoaded', function () {

            const createQuantity = document.getElementById('createSalesQuantity');
            const createPrice = document.getElementById('createSalesPrice');
            if (createQuantity && createPrice) {
                createQuantity.addEventListener('input', () => calculateSalesTotal('create'));
                createPrice.addEventListener('input', () => calculateSalesTotal('create'));
            }

            const updateQuantity = document.getElementById('updateSalesQuantity');
            const updatePrice = document.getElementById('updateSalesPrice');
            if (updateQuantity && updatePrice) {
                updateQuantity.addEventListener('input', () => calculateSalesTotal('update'));
                updatePrice.addEventListener('input', () => calculateSalesTotal('update'));
            }
        });

        async function getAllSales() {
            const spinner = document.getElementById('loadAllSalesSpinner');
            spinner.style.display = 'inline-block';

            try {
                const response = await fetch(SALES_API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allSales = data;
                    displaySalesGrid(data, 'salesGrid');
                    updateSalesStats(data);
                    populateSalesIdSelects();
                } else {
                    console.error('Error loading sales:', data);
                    document.getElementById('salesGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка завантаження продажів</p>';
                }
            } catch (error) {
                console.error('Error loading sales:', error);
                document.getElementById('salesGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка підключення до сервера</p>';
            } finally {
                spinner.style.display = 'none';
            }
        }


        async function getSalesById() {
            const id = document.getElementById('salesId').value;
            if (!id) {
                showResponse('salesByIdResponse', 'Будь ласка, виберіть ID продажу', true);
                document.getElementById('salesByIdGrid').innerHTML = '';
                return;
            }

            showLoading('salesByIdResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/${id}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('salesByIdResponse', `Знайдено продаж з ID ${id}`);
                    displaySalesGrid([data], 'salesByIdGrid');
                } else {
                    showResponse('salesByIdResponse', data, true);
                    document.getElementById('salesByIdGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('salesByIdResponse', `Помилка: ${error.message}`, true);
                document.getElementById('salesByIdGrid').innerHTML = '';
            }
        }


        async function getSalesByEmployee() {
            const employeeId = document.getElementById('salesEmployeeId').value;
            if (!employeeId) {
                showResponse('salesByEmployeeResponse', 'Будь ласка, виберіть співробітника', true);
                document.getElementById('salesByEmployeeGrid').innerHTML = '';
                return;
            }

            showLoading('salesByEmployeeResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/employee/${employeeId}`);
                const data = await response.json();

                if (response.ok) {
                    const employee = allEmployees.find(emp => emp.id == employeeId);
                    const employeeName = employee ? employee.fullName : 'вибраний співробітник';

                    showResponse('salesByEmployeeResponse', `Знайдено ${data.length} продажів для співробітника ${employeeName}`);
                    displaySalesGrid(data, 'salesByEmployeeGrid');
                } else {
                    showResponse('salesByEmployeeResponse', data, true);
                    document.getElementById('salesByEmployeeGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('salesByEmployeeResponse', `Помилка: ${error.message}`, true);
                document.getElementById('salesByEmployeeGrid').innerHTML = '';
            }
        }


        async function getSalesByProduct() {
            const productId = document.getElementById('salesProductId').value;
            if (!productId) {
                showResponse('salesByProductResponse', 'Будь ласка, виберіть товар', true);
                document.getElementById('salesByProductGrid').innerHTML = '';
                return;
            }

            showLoading('salesByProductResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/product/${productId}`);
                const data = await response.json();

                if (response.ok) {
                    const product = allGoods.find(goods => goods.id == productId);
                    const productName = product ? product.productName : 'вибраний товар';

                    showResponse('salesByProductResponse', `Знайдено ${data.length} продажів для товару "${productName}"`);
                    displaySalesGrid(data, 'salesByProductGrid');
                } else {
                    showResponse('salesByProductResponse', data, true);
                    document.getElementById('salesByProductGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('salesByProductResponse', `Помилка: ${error.message}`, true);
                document.getElementById('salesByProductGrid').innerHTML = '';
            }
        }


        async function getEmployeeSalesAnalysis() {
            showLoading('employeeSalesAnalysisResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/analysis/employees`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('employeeSalesAnalysisResponse', `Аналіз продажів для ${data.length} співробітників`);

                    const analysisHtml = data.map(analysis => `
                <div class="analysis-card">
                    <h4>${analysis.employeeName}</h4>
                    <div class="sales-info">
                        <span>Відділ:</span>
                        <div class="sales-value">${analysis.departmentName}</div>
                    </div>
                    <div class="sales-info">
                        <span>Кількість продажів:</span>
                        <div class="sales-value">${analysis.totalSales}</div>
                    </div>
                    <div class="sales-info">
                        <span>Загальна кількість:</span>
                        <div class="sales-value">${analysis.formattedTotalQuantity}</div>
                    </div>
                    <div class="sales-info">
                        <span>Загальна сума:</span>
                        <div class="sales-value sales-amount">${analysis.formattedTotalAmount}</div>
                    </div>
                    <div class="sales-info">
                        <span>Середня ціна:</span>
                        <div class="sales-value">${analysis.formattedAveragePrice}</div>
                    </div>
                </div>
            `).join('');

                    document.getElementById('employeeSalesAnalysisGrid').innerHTML = analysisHtml;
                } else {
                    showResponse('employeeSalesAnalysisResponse', data, true);
                    document.getElementById('employeeSalesAnalysisGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('employeeSalesAnalysisResponse', `Помилка: ${error.message}`, true);
                document.getElementById('employeeSalesAnalysisGrid').innerHTML = '';
            }
        }

        async function getSalesByPeriod() {
            const startDate = document.getElementById('analysisStartDate').value;
            const endDate = document.getElementById('analysisEndDate').value;

            if (!startDate || !endDate) {
                showResponse('salesPeriodAnalysisResponse', 'Будь ласка, виберіть дати початку та закінчення', true);
                document.getElementById('salesPeriodAnalysisGrid').innerHTML = '';
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                showResponse('salesPeriodAnalysisResponse', 'Дата початку не може бути пізніше дати закінчення', true);
                document.getElementById('salesPeriodAnalysisGrid').innerHTML = '';
                return;
            }

            showLoading('salesPeriodAnalysisResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/analysis/period?startDate=${startDate}&endDate=${endDate}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('salesPeriodAnalysisResponse', `Аналіз продажів за період з ${startDate} по ${endDate}`);


                    const analysisHtml = data.map(analysis => `
                <div class="analysis-card">
                    <h4>📅 ${analysis.formattedDate}</h4>
                    <div class="sales-info">
                        <span>Кількість продажів:</span>
                        <div class="sales-value">${analysis.totalSales}</div>
                    </div>
                    <div class="sales-info">
                        <span>Загальна кількість:</span>
                        <div class="sales-value">${analysis.formattedTotalQuantity}</div>
                    </div>
                    <div class="sales-info">
                        <span>Загальна сума:</span>
                        <div class="sales-value sales-amount">${analysis.formattedTotalAmount}</div>
                    </div>
                </div>
            `).join('');

                    document.getElementById('salesPeriodAnalysisGrid').innerHTML = analysisHtml;
                } else {
                    showResponse('salesPeriodAnalysisResponse', data, true);
                    document.getElementById('salesPeriodAnalysisGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('salesPeriodAnalysisResponse', `Помилка: ${error.message}`, true);
                document.getElementById('salesPeriodAnalysisGrid').innerHTML = '';
            }
        }


        async function createSales() {
            const employeeValue = document.getElementById('createSalesEmployee').value;
            const productValue = document.getElementById('createSalesProduct').value;
            const dateValue = document.getElementById('createSalesDate').value;
            const quantityValue = document.getElementById('createSalesQuantity').value;
            const priceValue = document.getElementById('createSalesPrice').value;

            if (!employeeValue || !productValue || !dateValue || !quantityValue || !priceValue) {
                showResponse('createSalesResponse', 'Будь ласка, заповніть всі обов\'язкові поля (позначені *)', true);
                return;
            }

            const employee = parseInt(employeeValue);
            const product = parseInt(productValue);
            const quantity = parseFloat(quantityValue);
            const price = parseFloat(priceValue);


            if (isNaN(employee) || isNaN(product) || isNaN(quantity) || isNaN(price)) {
                showResponse('createSalesResponse', 'Помилка: неправильні числові значення в полях', true);
                return;
            }

            //if (quantity <= 0) {
            //    showResponse('createSalesResponse', 'Кількість повинна бути більше нуля', true);
            //    return;
            //}

            //if (price <= 0) {
            //    showResponse('createSalesResponse', 'Ціна повинна бути більше нуля', true);
            //    return;
            //}

            const salesData = {
                employee: employee,
                product: product,
                date: dateValue,
                quantity: quantity,
                price: price
            };

            showLoading('createSalesResponse');

            try {
                const response = await fetch(SALES_API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(salesData)
                });

                if (response.ok) {
                    const data = await response.json();
                    showSuccess('createSalesResponse', `Продаж успішно створено! Загальна сума: ${data.formattedTotal}`);
                    document.getElementById('createSalesForm').reset();
                    calculateSalesTotal('create');
                    setMaxSalesDate();
                    await getAllSales();
                } else {
                    const errorData = await response.json();
                    const translatedMessage = parseSalesTriggerMessage(errorData);
                    showResponse('createSalesResponse', translatedMessage, true);
                }
            } catch (error) {
                showResponse('createSalesResponse', `Помилка підключення: ${error.message}`, true);
            }
        }


        async function loadSalesForUpdate() {
            const id = document.getElementById('updateSalesId').value;
            if (!id) {
                showResponse('updateSalesResponse', 'Будь ласка, виберіть ID продажу', true);
                return;
            }

            try {
                const response = await fetch(`${SALES_API_BASE}/${id}`);
                if (response.ok) {
                    const sales = await response.json();


                    const employee = allEmployees.find(emp => emp.fullName === sales.employeeFullName);
                    const product = allGoods.find(goods => goods.productName === sales.productName);

                    document.getElementById('updateSalesEmployee').value = employee ? employee.id : '';
                    document.getElementById('updateSalesProduct').value = product ? product.id : '';


                    const saleDate = new Date(sales.date);
                    const formattedDate = saleDate.toISOString().slice(0, 16);
                    document.getElementById('updateSalesDate').value = formattedDate;

                    document.getElementById('updateSalesQuantity').value = sales.quantity;
                    document.getElementById('updateSalesPrice').value = sales.price;


                    calculateSalesTotal('update');


                    document.getElementById('updateSalesForm').style.display = 'block';
                    showResponse('updateSalesResponse', 'Дані продажу завантажені успішно');
                } else {
                    const error = await response.json();
                    showResponse('updateSalesResponse', error, true);
                }
            } catch (error) {
                showResponse('updateSalesResponse', `Помилка: ${error.message}`, true);
            }
        }

        async function updateSales() {
            const id = document.getElementById('updateSalesId').value;
            const employeeValue = document.getElementById('updateSalesEmployee').value;
            const productValue = document.getElementById('updateSalesProduct').value;
            const dateValue = document.getElementById('updateSalesDate').value;
            const quantityValue = document.getElementById('updateSalesQuantity').value;
            const priceValue = document.getElementById('updateSalesPrice').value;


            if (!employeeValue || !productValue || !dateValue || !quantityValue || !priceValue) {
                showResponse('updateSalesResponse', 'Будь ласка, заповніть всі обов\'язкові поля', true);
                return;
            }

            const employee = parseInt(employeeValue);
            const product = parseInt(productValue);
            const quantity = parseFloat(quantityValue);
            const price = parseFloat(priceValue);

            if (isNaN(employee) || isNaN(product) || isNaN(quantity) || isNaN(price)) {
                showResponse('updateSalesResponse', 'Помилка: неправильні числові значення в полях', true);
                return;
            }

            //if (quantity <= 0 || price <= 0) {
            //    showResponse('updateSalesResponse', 'Кількість та ціна повинні бути більше нуля', true);
            //    return;
            //}

            const salesData = {
                employee: employee,
                product: product,
                date: dateValue,
                quantity: quantity,
                price: price
            };

            showLoading('updateSalesResponse');

            try {
                const response = await fetch(`${SALES_API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(salesData)
                });

                if (response.ok) {
                    const data = await response.json();
                    await getAllSales();
                    document.getElementById('updateSalesForm').style.display = 'none';
                    showSuccess('updateSalesResponse', `Дані продажу успішно оновлено! Нова сума: ${data.formattedTotal}`);
                } else {
                    const errorData = await response.json();
                    const translatedMessage = parseSalesTriggerMessage(errorData);
                    showResponse('updateSalesResponse', translatedMessage, true);
                }
            } catch (error) {
                showResponse('updateSalesResponse', `Помилка підключення: ${error.message}`, true);
            }
        }

        async function deleteSales() {
            const id = document.getElementById('deleteSalesId').value;
            if (!id) {
                showResponse('deleteSalesResponse', 'Будь ласка, виберіть ID продажу', true);
                return;
            }


            const sales = allSales.find(s => s.id == id);
            const salesInfo = sales ? `${sales.employeeName} - ${sales.productName}` : `ID ${id}`;

            if (!confirm(`Ви впевнені, що хочете видалити продаж "${salesInfo}"?`)) {
                return;
            }

            showLoading('deleteSalesResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showResponse('deleteSalesResponse', `Продаж "${salesInfo}" успішно видалено`);
                    document.getElementById('deleteSalesId').value = '';
                    await getAllSales();
                } else {
                    const error = await response.json();
                    showResponse('deleteSalesResponse', error, true);
                }
            } catch (error) {
                showResponse('deleteSalesResponse', `Помилка: ${error.message}`, true);
            }
        }


        async function getProductsByDepartmentAndCountry() {
            const departmentId = document.getElementById('procedureDepartmentId').value;
            const countryId = document.getElementById('procedureCountryId').value;

            if (!departmentId) {
                showResponse('procedureProductsResponse', 'Будь ласка, виберіть відділ', true);
                document.getElementById('procedureProductsGrid').innerHTML = '';
                return;
            }

            showLoading('procedureProductsResponse');

            try {
                let url = `${SALES_API_BASE}/products/department/${departmentId}`;
                if (countryId) {
                    url += `?countryId=${countryId}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (response.ok) {
                    const department = departments.find(d => d.id == departmentId);
                    const country = countryId ? countries.find(c => c.id == countryId) : null;
                    const departmentName = department ? department.departmentName : 'вибраний відділ';
                    const countryName = country ? ` з країни ${country.countryName}` : '';

                    showResponse('procedureProductsResponse',
                        `Знайдено ${data.length} товарів у відділі "${departmentName}"${countryName}`);
                    displayGoodsGrid(data, 'procedureProductsGrid');
                } else {
                    showResponse('procedureProductsResponse', data, true);
                    document.getElementById('procedureProductsGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('procedureProductsResponse', `Помилка: ${error.message}`, true);
                document.getElementById('procedureProductsGrid').innerHTML = '';
            }
        }


        async function checkDepartmentWorkingStatus() {
            const departmentId = document.getElementById('workingStatusDepartmentId').value;
            const checkTime = document.getElementById('checkTime').value;

            if (!departmentId || !checkTime) {
                showResponse('workingStatusResponse', 'Будь ласка, виберіть відділ та час', true);
                document.getElementById('workingStatusGrid').innerHTML = '';
                return;
            }

            showLoading('workingStatusResponse');

            try {
                const response = await fetch(`${SALES_API_BASE}/department/${departmentId}/working-status?checkTime=${checkTime}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('workingStatusResponse', `Перевірка статусу роботи відділу на ${checkTime}`);


                    const statusHtml = `
                <div class="procedure-card">
                    <h4>🏢 ${data.departmentName}</h4>
                    <div class="sales-info">
                        <span>Час відкриття:</span>
                        <div class="sales-value">${data.openingTime}</div>
                    </div>
                    <div class="sales-info">
                        <span>Час закриття:</span>
                        <div class="sales-value">${data.closingTime}</div>
                    </div>
                    <div class="sales-info">
                        <span>Перевіряємий час:</span>
                        <div class="sales-value">${data.checkedTime}</div>
                    </div>
                    <div class="working-status ${data.isWorking ? 'working' : 'not-working'}">
                        ${data.workingStatus === 'Department works' ? '✅ Відділ працює' : '❌ Відділ не працює'}
                    </div>
                </div>
            `;

                    document.getElementById('workingStatusGrid').innerHTML = statusHtml;
                } else {
                    showResponse('workingStatusResponse', data, true);
                    document.getElementById('workingStatusGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('workingStatusResponse', `Помилка: ${error.message}`, true);
                document.getElementById('workingStatusGrid').innerHTML = '';
            }
        }





        const DEPARTMENTS_API_BASE = 'http://localhost:5109/api/departments';
        let allDepartments = [];


    //    function displayDepartmentsGrid(departments, gridId) {
    //        const grid = document.getElementById(gridId);
    //        if (departments.length === 0) {
    //            grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">Відділи не знайдені.</p>';
    //            return;
    //        }

    //        grid.innerHTML = departments.map(dept => `
    //    <div class="employee-card" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);">
    //        <h4>${dept.departmentName}</h4>
    //        <div class="employee-info">
    //            <span>ID:</span>
    //            <div class="employee-value">${dept.id}</div>
    //        </div>
    //        <div class="employee-info">
    //            <span>Ряд:</span>
    //            <div class="employee-value">${dept.locationRow}</div>
    //        </div>
    //        <div class="employee-info">
    //            <span>Наявність акцій:</span>
    //            <div class="employee-value">${dept.salesStatus}</div>
    //        </div>
    //        <div class="employee-info">
    //            <span>Прилавки:</span>
    //            <div class="employee-value">${dept.counters}</div>
    //        </div>
    //        <div class="employee-info">
    //            <span>Час роботи:</span>
    //            <div class="employee-value">${dept.workingHours}</div>
    //        </div>
    //    </div>
    //`).join('');
    //    }


        function displayDepartmentsGrid(departments, gridId) {
            const grid = document.getElementById(gridId);
            if (departments.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">Відділи не знайдені.</p>';
                return;
            }

            console.log('Displaying departments:', departments); // Для отладки

            grid.innerHTML = departments.map(dept => `
        <div class="employee-card" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);">
            <h4>${dept.departmentName}</h4>
            <div class="employee-info">
                <span>ID:</span>
                <div class="employee-value">${dept.id}</div>
            </div>
            <div class="employee-info">
                <span>Ряд:</span>
                <div class="employee-value">${dept.locationRow}</div>
            </div>
            <div class="employee-info">
                <span>Торговий:</span>
                <div class="employee-value">${dept.salesStatus}</div>
            </div>
            <div class="employee-info">
                <span>Прилавки:</span>
                <div class="employee-value">${dept.counters}</div>
            </div>
            <div class="employee-info">
                <span>Час роботи:</span>
                <div class="employee-value">${dept.workingHours}</div>
            </div>
        </div>
    `).join('');
        }

        //function updateDepartmentsStats(departments) {
        //    if (departments && departments.length > 0) {
        //        const salesCount = departments.filter(d => d.sales).length;
        //        const avgCounters = departments.reduce((sum, d) => sum + d.counters, 0) / departments.length;

        //        document.getElementById('totalDepartments').textContent = departments.length;
        //        document.getElementById('salesDepartments').textContent = salesCount;
        //        document.getElementById('avgCounters').textContent = Math.round(avgCounters);

        //        document.getElementById('departmentsStatsBar').style.display = 'grid';
        //    }
        //}


        //function updateDepartmentsStats(departments) {
        //    console.log('Updating departments stats:', departments); // Для отладки

        //    if (departments && departments.length > 0) {
        //        // Используем правильные имена свойств из API
        //        const salesCount = departments.filter(d => d.sales).length;
        //        const avgCounters = departments.reduce((sum, d) => sum + d.counters, 0) / departments.length;

        //        document.getElementById('totalDepartments').textContent = departments.length;
        //        document.getElementById('salesDepartments').textContent = salesCount;
        //        document.getElementById('avgCounters').textContent = Math.round(avgCounters);

        //        document.getElementById('departmentsStatsBar').style.display = 'grid';
        //    } else {
        //        console.log('No departments data or empty array');
        //    }
        //}

        // Функция для заполнения выпадающего списка отделов
        function populateDepartmentSelectForUpdate() {
            const select = document.getElementById('updateDepartmentId');
            select.innerHTML = '<option value="">Виберіть відділ</option>';
            allDepartments.forEach(dept => {
                select.innerHTML += `<option value="${dept.id}">${dept.departmentName} (Ряд ${dept.locationRow})</option>`;
            });
        }

        // Получить все отделы
        async function getAllDepartments() {
            const spinner = document.getElementById('loadAllDepartmentsSpinner');
            spinner.style.display = 'inline-block';

            try {
                const response = await fetch(DEPARTMENTS_API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allDepartments = data;
                    displayDepartmentsGrid(data, 'departmentsGrid');
                  /*  updateDepartmentsStats(data);*/
                    populateDepartmentSelectForUpdate();
                } else {
                    console.error('Error loading departments:', data);
                    document.getElementById('departmentsGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка завантаження відділів</p>';
                }
            } catch (error) {
                console.error('Error loading departments:', error);
                document.getElementById('departmentsGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка підключення до сервера</p>';
            } finally {
                spinner.style.display = 'none';
            }
        }

        // Загрузить данные отдела для редактирования
        async function loadDepartmentForUpdate() {
            const id = document.getElementById('updateDepartmentId').value;
            if (!id) {
                showResponse('updateDepartmentResponse', 'Будь ласка, виберіть відділ', true);
                return;
            }

            try {
                const response = await fetch(`${DEPARTMENTS_API_BASE}/${id}`);
                if (response.ok) {
                    const department = await response.json();

                    // Заполняем форму данными отдела
                    document.getElementById('updateDeptName').value = department.departmentName;
                    document.getElementById('updateLocationRow').value = department.locationRow;
                    document.getElementById('updateSales').value = department.sales.toString();
                    document.getElementById('updateCounters').value = department.counters;
                    document.getElementById('updateStartTime').value = department.formattedStartTime;
                    document.getElementById('updateEndTime').value = department.formattedEndTime;

                    // Показываем форму
                    document.getElementById('updateDepartmentForm').style.display = 'block';
                    showResponse('updateDepartmentResponse', 'Дані відділу завантажені успішно');
                } else {
                    const error = await response.json();
                    showResponse('updateDepartmentResponse', error, true);
                }
            } catch (error) {
                showResponse('updateDepartmentResponse', `Помилка: ${error.message}`, true);
            }
        }

        // Обновить отдел
        async function updateDepartment() {
            const id = document.getElementById('updateDepartmentId').value;
            const departmentData = {
                departmentName: document.getElementById('updateDeptName').value.trim(),
                locationRow: parseInt(document.getElementById('updateLocationRow').value),
                sales: document.getElementById('updateSales').value === 'true',
                counters: parseInt(document.getElementById('updateCounters').value),
                startTime: document.getElementById('updateStartTime').value + ':00',
                endTime: document.getElementById('updateEndTime').value + ':00'
            };

            // Базовая валидация
            if (!departmentData.departmentName) {
                showResponse('updateDepartmentResponse', 'Назва відділу є обов\'язковою', true);
                return;
            }

            if (isNaN(departmentData.locationRow) || departmentData.locationRow < 0) {
                showResponse('updateDepartmentResponse', 'Номер ряду повинен бути не менше 0', true);
                return;
            }

            if (isNaN(departmentData.counters) || departmentData.counters < 0) {
                showResponse('updateDepartmentResponse', 'Кількість прилавків повинна бути не менше 0', true);
                return;
            }

            if (departmentData.startTime >= departmentData.endTime) {
                showResponse('updateDepartmentResponse', 'Час відкриття повинен бути раніше часу закриття', true);
                return;
            }

            showLoading('updateDepartmentResponse');

            try {
                const response = await fetch(`${DEPARTMENTS_API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(departmentData)
                });

                if (response.ok) {
                    const data = await response.json();
                    await getAllDepartments(); // Обновляем список отделов
                    document.getElementById('updateDepartmentForm').style.display = 'none';
                    showSuccess('updateDepartmentResponse', `Відділ "${data.departmentName}" успішно оновлено!`);
                } else {
                    const errorData = await response.json();
                    showResponse('updateDepartmentResponse', errorData, true);
                }
            } catch (error) {
                showResponse('updateDepartmentResponse', `Помилка підключення: ${error.message}`, true);
            }
        }
    </script>-->
    <script>
        const API_BASE = 'http://localhost:5109/api/employees';
        const GOODS_API_BASE = 'http://localhost:5109/api/goods';
        const SALES_API_BASE = 'http://localhost:5109/api/sales';
        const DEPARTMENTS_API_BASE = 'http://localhost:5109/api/departments';

        let genders = [];
        let departments = [];
        let positions = [];
        let countries = [];
        let allEmployees = [];
        let allGoods = [];
        let allSales = [];
        let allDepartments = [];

        async function loadEmployeesForSelects() {
            if (allEmployees.length > 0) return; // Уже загружены

            try {
                const response = await fetch(API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allEmployees = data;
                    populateEmployeeIdSelects();
                    populateSalesSelects();
                    console.log(`Загружено ${data.length} сотрудников для селектов`);
                }
            } catch (error) {
                console.error('Error loading employees for selects:', error);
            }
        }

        // Загрузка товаров только для селектов (без отображения в сетке)
        async function loadGoodsForSelects() {
            if (allGoods.length > 0) return; // Уже загружены

            try {
                const response = await fetch(GOODS_API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allGoods = data;
                    populateGoodsIdSelects();
                    populateSalesSelects();
                    console.log(`Загружено ${data.length} товаров для селектов`);
                }
            } catch (error) {
                console.error('Error loading goods for selects:', error);
            }
        }

        // Загрузка продаж только для селектов (без отображения в сетке)
        async function loadSalesForSelects() {
            if (allSales.length > 0) return; // Уже загружены

            try {
                const response = await fetch(SALES_API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allSales = data;
                    populateSalesIdSelects();
                    console.log(`Загружено ${data.length} продаж для селектов`);
                }
            } catch (error) {
                console.error('Error loading sales for selects:', error);
            }
        }

        // =================== ИСПРАВЛЕННАЯ ИНИЦИАЛИЗАЦИЯ ===================

        window.addEventListener('load', async () => {
            setMaxDates();
            await loadReferenceData();
            await loadGoodsReferenceData();
            setMaxSalesDate();

            // Загружаем данные только для селектов (без отображения в сетках)
            await loadEmployeesForSelects();
            await loadGoodsForSelects();
            await loadSalesForSelects();
        });

        // =================== ОСТАЛЬНЫЕ ФУНКЦИИ БЕЗ ИЗМЕНЕНИЙ ===================

        async function loadReferenceData() {
            try {
                const gendersResponse = await fetch(`${API_BASE}/genders`);
                if (gendersResponse.ok) {
                    genders = await gendersResponse.json();
                    populateGenderSelects();
                }

                const departmentsResponse = await fetch(`${API_BASE}/departments`);
                if (departmentsResponse.ok) {
                    departments = await departmentsResponse.json();
                    populateDepartmentSelects();
                }

                const positionsResponse = await fetch(`${API_BASE}/positions`);
                if (positionsResponse.ok) {
                    positions = await positionsResponse.json();
                    populatePositionSelects();
                }
            } catch (error) {
                console.error('Error loading reference data:', error);
            }
        }

        function populateGenderSelects() {
            const selects = ['createGender', 'updateGender'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Виберіть стать</option>';
                genders.forEach(gender => {
                    select.innerHTML += `<option value="${gender.id}">${gender.genderName}</option>`;
                });
            });
        }

        function populateDepartmentSelects() {
            const selects = ['departmentName', 'createDepartment', 'updateDepartment'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const isForSearch = selectId === 'departmentName';
                select.innerHTML = '<option value="">Виберіть відділ</option>';

                departments.forEach(dept => {
                    const value = isForSearch ? dept.departmentName : dept.id;
                    select.innerHTML += `<option value="${value}">${dept.departmentName}</option>`;
                });
            });
        }

        function populatePositionSelects() {
            const selects = ['createJobTitle', 'updateJobTitle', 'searchJobTitle'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;

                const isForSearch = selectId === 'searchJobTitle';
                select.innerHTML = '<option value="">Виберіть посаду</option>';

                positions.forEach(position => {
                    const displayText = isForSearch
                        ? `${position.jobTitleName} (${position.salary} грн)`
                        : `${position.jobTitleName} (${position.salary} грн, ${position.workingTime} год)`;
                    select.innerHTML += `<option value="${position.id}">${displayText}</option>`;
                });
            });
        }

        function populateEmployeeIdSelects() {
            const selects = ['employeeId', 'updateId', 'deleteId'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Виберіть ID співробітника</option>';
                allEmployees.forEach(emp => {
                    select.innerHTML += `<option value="${emp.id}">${emp.id} - ${emp.fullName}</option>`;
                });
            });
        }

        function parseTriggerMessage(errorResponse) {
            let message = '';

            if (typeof errorResponse === 'string') {
                message = errorResponse;
            } else if (errorResponse.title || errorResponse.detail || errorResponse.message) {
                message = errorResponse.title || errorResponse.detail || errorResponse.message;
            } else {
                message = JSON.stringify(errorResponse);
            }

            const triggerMessages = {
                'Employee must be at least 18 years old!': '❌ Співробітник повинен бути не молодше 18 років!',
                'Work experience cannot exceed employee age minus 18 years!': '❌ Досвід роботи не може перевищувати вік мінус 18 років!',
                'Phone number must start with 380 and be 12 digits long!': '❌ Номер телефону повинен починатися з 380 і містити 12 цифр!',
                'City name must be specified and be at least 2 characters long!': '❌ Назва міста повинна бути вказана і містити мінімум 2 символи!',
                'The specified job title does not exist!': '❌ Вказана посада не існує!',
                'The specified department does not exist!': '❌ Вказаний відділ не існує!',
                'The specified gender does not exist!': '❌ Вказана стать не існує!',
                'Employee cannot have zero experience if employed more than 6 months ago!': '❌ Співробітник не може мати нульовий досвід, якщо працевлаштований більше 6 місяців тому!'
            };

            for (const [englishMsg, ukrainianMsg] of Object.entries(triggerMessages)) {
                if (message.includes(englishMsg)) {
                    return ukrainianMsg;
                }
            }

            return `⚠️ Помилка валідації: ${message}`;
        }

        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';

            let message = '';
            if (isError) {
                message = parseTriggerMessage(data);
                element.className = 'response error';
            } else {
                message = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
                element.className = 'response success';
            }

            element.textContent = message;
        }

        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'response success';
            element.textContent = `✅ ${message}`;
        }

        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'response loading';
            element.textContent = 'Завантаження...';
        }

        function updateStats(employees) {
            if (employees && employees.length > 0) {
                document.getElementById('totalEmployees').textContent = employees.length;
                document.getElementById('totalDepartments').textContent = new Set(employees.map(e => e.departmentName)).size;

                const avgAge = employees.reduce((sum, emp) => sum + emp.age, 0) / employees.length;
                document.getElementById('avgAge').textContent = Math.round(avgAge);

                document.getElementById('statsBar').style.display = 'grid';
            }
        }

        // =================== ИСПРАВЛЕННАЯ ФУНКЦИЯ getAllEmployees ===================
        async function getAllEmployees() {
            const spinner = document.getElementById('loadAllSpinner');
            spinner.style.display = 'inline-block';

            try {
                // Если данные уже загружены для селектов, просто отображаем их
                if (allEmployees.length > 0) {
                    displayEmployeesGrid(allEmployees, 'employeesGrid');
                    updateStats(allEmployees);
                    populateEmployeeIdSelects(); // На всякий случай обновляем селекты
                    populateSalesSelects();
                    spinner.style.display = 'none';
                    return;
                }

                // Иначе загружаем как обычно
                const response = await fetch(API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allEmployees = data;
                    displayEmployeesGrid(data, 'employeesGrid');
                    updateStats(data);
                    populateEmployeeIdSelects();
                    populateSalesSelects();
                } else {
                    console.error('Error loading employees:', data);
                    document.getElementById('employeesGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка завантаження співробітників</p>';
                }
            } catch (error) {
                console.error('Error loading employees:', error);
                document.getElementById('employeesGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка підключення до сервера</p>';
            } finally {
                spinner.style.display = 'none';
            }
        }

        function displayEmployeesGrid(employees, gridId) {
            const grid = document.getElementById(gridId);
            if (employees.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">Співробітники не знайдені.</p>';
                return;
            }

            grid.innerHTML = employees.map(emp => `
                            <div class="employee-card">
                                <h4>${emp.fullName}</h4>
                                <div class="employee-info">
                                    <span>ID:</span>
                                    <div class="employee-value">${emp.id}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Стать:</span>
                                    <div class="employee-value">${emp.gender}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Вік:</span>
                                    <div class="employee-value">${emp.age} років</div>
                                </div>
                                <div class="employee-info">
                                    <span>Телефон:</span>
                                    <div class="employee-value">${emp.phoneNumber}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Місто:</span>
                                    <div class="employee-value">${emp.city}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Відділ:</span>
                                    <div class="employee-value">${emp.departmentName}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Посада:</span>
                                    <div class="employee-value">${emp.jobTitleName}</div>
                                </div>
                                <div class="employee-info">
                                    <span>Зарплата:</span>
                                    <div class="employee-value">${emp.salary.toLocaleString()} грн</div>
                                </div>
                                <div class="employee-info">
                                    <span>Досвід:</span>
                                    <div class="employee-value">${emp.experienceYear} років</div>
                                </div>
                                <div class="employee-info">
                                    <span>Прийнятий:</span>
                                    <div class="employee-value">${new Date(emp.yearOfEmployment).toLocaleDateString('uk-UA')}</div>
                                </div>
                            </div>
                        `).join('');
        }

        async function getEmployeeById() {
            const id = document.getElementById('employeeId').value;
            if (!id) {
                showResponse('employeeByIdResponse', 'Будь ласка, виберіть ID співробітника', true);
                document.getElementById('employeeByIdGrid').innerHTML = '';
                return;
            }

            showLoading('employeeByIdResponse');
            try {
                const response = await fetch(`${API_BASE}/${id}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('employeeByIdResponse', `Знайдено співробітника з ID ${id}`);
                    displayEmployeesGrid([data], 'employeeByIdGrid');
                } else {
                    showResponse('employeeByIdResponse', data, true);
                    document.getElementById('employeeByIdGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('employeeByIdResponse', `Помилка: ${error.message}`, true);
                document.getElementById('employeeByIdGrid').innerHTML = '';
            }
        }

        async function getEmployeesByDepartment() {
            const department = document.getElementById('departmentName').value;
            if (!department) {
                showResponse('departmentResponse', 'Будь ласка, виберіть відділ', true);
                return;
            }

            showLoading('departmentResponse');
            try {
                const response = await fetch(`${API_BASE}/department/${encodeURIComponent(department)}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('departmentResponse', `Знайдено ${data.length} співробітників у відділі "${department}"`);
                    displayEmployeesGrid(data, 'departmentGrid');
                } else {
                    showResponse('departmentResponse', data, true);
                    document.getElementById('departmentGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('departmentResponse', `Помилка: ${error.message}`, true);
                document.getElementById('departmentGrid').innerHTML = '';
            }
        }

        async function getEmployeesByPositionAndExperience() {
            const jobTitleId = document.getElementById('searchJobTitle').value;
            const minExperience = document.getElementById('minExperience').value || 0;
            const maxExperience = document.getElementById('maxExperience').value || 100;

            if (!jobTitleId) {
                showResponse('positionExperienceResponse', 'Будь ласка, виберіть посаду', true);
                document.getElementById('positionExperienceGrid').innerHTML = '';
                return;
            }

            if (parseInt(minExperience) > parseInt(maxExperience)) {
                showResponse('positionExperienceResponse', 'Мінімальний досвід не може бути більшим за максимальний', true);
                document.getElementById('positionExperienceGrid').innerHTML = '';
                return;
            }

            showLoading('positionExperienceResponse');

            try {
                const url = `${API_BASE}/position/${jobTitleId}/experience?minExperience=${minExperience}&maxExperience=${maxExperience}`;
                const response = await fetch(url);
                const data = await response.json();

                if (response.ok) {
                    const selectedPosition = positions.find(p => p.id == jobTitleId);
                    const positionName = selectedPosition ? selectedPosition.jobTitleName : 'вибрана посада';

                    showResponse('positionExperienceResponse',
                        `Знайдено ${data.length} співробітників на посаді "${positionName}" з досвідом ${minExperience}-${maxExperience} років`);
                    displayEmployeesGrid(data, 'positionExperienceGrid');
                } else {
                    showResponse('positionExperienceResponse', data, true);
                    document.getElementById('positionExperienceGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('positionExperienceResponse', `Помилка: ${error.message}`, true);
                document.getElementById('positionExperienceGrid').innerHTML = '';
            }
        }

        async function createEmployee() {
            const name = document.getElementById('createName').value.trim();
            const lastName = document.getElementById('createLastName').value.trim();
            const surname = document.getElementById('createSurname').value.trim();
            const genderValue = document.getElementById('createGender').value;
            const dateOfBirth = document.getElementById('createDateOfBirth').value;
            const phoneNumber = document.getElementById('createPhoneNumber').value.trim();
            const address = document.getElementById('createAddress').value.trim();
            const city = document.getElementById('createCity').value.trim();
            const departmentValue = document.getElementById('createDepartment').value;
            const jobTitleValue = document.getElementById('createJobTitle').value;
            const experienceValue = document.getElementById('createExperienceYear').value;
            const yearOfEmployment = document.getElementById('createYearOfEmployment').value;

            if (!name || !lastName || !phoneNumber || !address || !city) {
                showResponse('createResponse', 'Будь ласка, заповніть всі обов\'язкові поля (позначені *)', true);
                return;
            }

            if (!genderValue || !departmentValue || !jobTitleValue || !experienceValue || !dateOfBirth || !yearOfEmployment) {
                showResponse('createResponse', 'Будь ласка, виберіть значення для всіх обов\'язкових полів', true);
                return;
            }

            const gender = parseInt(genderValue);
            const department = parseInt(departmentValue);
            const jobTitle = parseInt(jobTitleValue);
            const experienceYear = parseInt(experienceValue);

            if (isNaN(gender) || isNaN(department) || isNaN(jobTitle) || isNaN(experienceYear)) {
                showResponse('createResponse', 'Помилка: неправильні числові значення в полях', true);
                return;
            }

            const employeeData = {
                name: name,
                lastName: lastName,
                surname: surname || null,
                gender: gender,
                dateOfBirth: dateOfBirth,
                phoneNumber: phoneNumber,
                address: address,
                city: city,
                department: department,
                experienceYear: experienceYear,
                jobTitle: jobTitle,
                yearOfEmployment: yearOfEmployment
            };

            showLoading('createResponse');

            try {
                const response = await fetch(API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(employeeData)
                });

                //if (response.ok) {
                //    const data = await response.json();

                //    const originalDate = new Date(yearOfEmployment);
                //    const returnedDate = new Date(data.yearOfEmployment);

                //    if (originalDate > new Date() && returnedDate.toDateString() === new Date().toDateString()) {
                //        showSuccess('createResponse', 'Співробітника успішно створено! 📅 Дата прийняття на роботу була автоматично скорегована на сьогоднішню.');
                //    } else {
                //        showSuccess('createResponse', 'Співробітника успішно створено!');
                //    }

                //    document.getElementById('createForm').reset();

                //    // Обновляем список сотрудников для селектов
                //    allEmployees = [];
                //    /*await loadEmployeesForSelects();*/
                //    await getAllEmployees();
                //} 
                if (response.ok) {
                    const data = await response.json();

                    // Сравниваем введенную и сохраненную даты
                    const inputDateStr = new Date(yearOfEmployment).toLocaleDateString('uk-UA');
                    const savedDateStr = new Date(data.yearOfEmployment).toLocaleDateString('uk-UA');

                    let message = '✅ Співробітника успішно створено!\n\n';

                    if (inputDateStr !== savedDateStr) {
                        message += `📅 Дата прийняття на роботу:\n`;
                        message += `   Введена: ${inputDateStr}\n`;
                        message += `   Збережена: ${savedDateStr}\n`;
                        message += `   (автоматично скорегована системою)`;
                    } else {
                        message += `📅 Дата прийняття: ${savedDateStr}`;
                    }

                    showSuccess('createResponse', message);
                    document.getElementById('createForm').reset();
                    allEmployees = [];
                    await getAllEmployees();
                }
                else {
                    const errorData = await response.json();
                    showResponse('createResponse', errorData, true);
                }
            } catch (error) {
                showResponse('createResponse', `Помилка підключення: ${error.message}`, true);
            }
        }

        async function loadEmployeeForUpdate() {
            const id = document.getElementById('updateId').value;
            if (!id) {
                showResponse('updateResponse', 'Будь ласка, виберіть ID співробітника', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/${id}`);
                if (response.ok) {
                    const employee = await response.json();

                    document.getElementById('updateName').value = employee.name;
                    document.getElementById('updateLastName').value = employee.lastName;
                    document.getElementById('updateSurname').value = employee.surname || '';

                    const gender = genders.find(g => g.genderName === employee.gender);
                    document.getElementById('updateGender').value = gender ? gender.id : '';

                    document.getElementById('updateDateOfBirth').value = employee.dateOfBirth.split('T')[0];
                    document.getElementById('updatePhoneNumber').value = employee.phoneNumber;
                    document.getElementById('updateAddress').value = employee.address;
                    document.getElementById('updateCity').value = employee.city;

                    const department = departments.find(d => d.departmentName === employee.departmentName);
                    document.getElementById('updateDepartment').value = department ? department.id : '';

                    const position = positions.find(p => p.jobTitleName === employee.jobTitleName);
                    document.getElementById('updateJobTitle').value = position ? position.id : '';

                    document.getElementById('updateExperienceYear').value = employee.experienceYear;
                    document.getElementById('updateYearOfEmployment').value = employee.yearOfEmployment.split('T')[0];

                    document.getElementById('updateForm').style.display = 'block';
                    showResponse('updateResponse', 'Дані співробітника завантажені успішно');
                } else {
                    const error = await response.json();
                    showResponse('updateResponse', error, true);
                }
            } catch (error) {
                showResponse('updateResponse', `Помилка: ${error.message}`, true);
            }
        }

        async function updateEmployee() {
            const id = document.getElementById('updateId').value;
            const employeeData = {
                name: document.getElementById('updateName').value.trim(),
                lastName: document.getElementById('updateLastName').value.trim(),
                surname: document.getElementById('updateSurname').value.trim() || null,
                gender: parseInt(document.getElementById('updateGender').value),
                dateOfBirth: document.getElementById('updateDateOfBirth').value,
                phoneNumber: document.getElementById('updatePhoneNumber').value.trim(),
                address: document.getElementById('updateAddress').value.trim(),
                city: document.getElementById('updateCity').value.trim(),
                department: parseInt(document.getElementById('updateDepartment').value),
                experienceYear: parseInt(document.getElementById('updateExperienceYear').value),
                jobTitle: parseInt(document.getElementById('updateJobTitle').value),
                yearOfEmployment: document.getElementById('updateYearOfEmployment').value
            };

            if (!employeeData.name || !employeeData.lastName || !employeeData.phoneNumber) {
                showResponse('updateResponse', 'Будь ласка, заповніть всі обов\'язкові поля', true);
                return;
            }

            showLoading('updateResponse');
            try {
                const originalDate = new Date(employeeData.yearOfEmployment);

                const response = await fetch(`${API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(employeeData)
                });

                //if (response.ok) {
                //    const data = await response.json();
                //    document.getElementById('updateForm').style.display = 'none';

                //    const returnedDate = new Date(data.yearOfEmployment);
                //    if (originalDate > new Date() && returnedDate.toDateString() === new Date().toDateString()) {
                //        showSuccess('updateResponse', 'Дані співробітника успішно оновлено! 📅 Дата прийняття на роботу була автоматично скорегована на сьогоднішню.');
                //    } else {
                //        showSuccess('updateResponse', 'Дані співробітника успішно оновлено!');
                //    }

                //    // Обновляем список сотрудников для селектов
                //    allEmployees = [];
                //    /* await loadEmployeesForSelects();*/
                //    await getAllEmployees();
                //} 
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('updateForm').style.display = 'none';

                    const inputDateStr = new Date(employeeData.yearOfEmployment).toLocaleDateString('uk-UA');
                    const savedDateStr = new Date(data.yearOfEmployment).toLocaleDateString('uk-UA');

                    let message = '✅ Дані співробітника успішно оновлено!\n\n';

                    if (inputDateStr !== savedDateStr) {
                        message += `📅 Дата прийняття на роботу:\n`;
                        message += `   Введена: ${inputDateStr}\n`;
                        message += `   Збережена: ${savedDateStr}\n`;
                        message += `   (автоматично скорегована системою)`;
                    } else {
                        message += `📅 Дата прийняття: ${savedDateStr}`;
                    }

                    showSuccess('updateResponse', message);
                    allEmployees = [];
                    await getAllEmployees();
                }
                else {
                    const errorData = await response.json();
                    showResponse('updateResponse', errorData, true);
                }
            } catch (error) {
                showResponse('updateResponse', `Помилка підключення: ${error.message}`, true);
            }
        }

        async function deleteEmployee() {
            const id = document.getElementById('deleteId').value;
            if (!id) {
                showResponse('deleteResponse', 'Будь ласка, виберіть ID співробітника', true);
                return;
            }

            const employee = allEmployees.find(emp => emp.id == id);
            const employeeName = employee ? employee.fullName : `ID ${id}`;

            if (!confirm(`Ви впевнені, що хочете видалити співробітника ${employeeName}?`)) {
                return;
            }

            showLoading('deleteResponse');
            try {
                const response = await fetch(`${API_BASE}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showResponse('deleteResponse', `Співробітника ${employeeName} успішно видалено`);
                    document.getElementById('deleteId').value = '';

                  
                    allEmployees = [];
                    /* await loadEmployeesForSelects();*/
                    await getAllEmployees();
                } else {
                    const error = await response.json();
                    showResponse('deleteResponse', error, true);
                }
            } catch (error) {
                showResponse('deleteResponse', `Помилка: ${error.message}`, true);
            }
        }

        function setMaxDates() {
            const today = new Date().toISOString().split('T')[0];
            const maxBirthDate = new Date();
            maxBirthDate.setFullYear(maxBirthDate.getFullYear() - 18);
            const maxBirth = maxBirthDate.toISOString().split('T')[0];

            document.getElementById('createDateOfBirth').setAttribute('max', maxBirth);
            document.getElementById('updateDateOfBirth').setAttribute('max', maxBirth);
            document.getElementById('createYearOfEmployment').setAttribute('max', today);
            document.getElementById('updateYearOfEmployment').setAttribute('max', today);
        }

        async function loadGoodsReferenceData() {
            try {
                const countriesResponse = await fetch(`${GOODS_API_BASE}/countries`);
                if (countriesResponse.ok) {
                    countries = await countriesResponse.json();
                    populateCountrySelects();
                }

                populateGoodsDepartmentSelects();
            } catch (error) {
                console.error('Error loading goods reference data:', error);
            }
        }

        function populateCountrySelects() {
            const selects = ['createGoodsCountry', 'updateGoodsCountry'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Виберіть країну</option>';
                countries.forEach(country => {
                    select.innerHTML += `<option value="${country.id}">${country.countryName}</option>`;
                });
            });
        }

        function populateGoodsDepartmentSelects() {
            const selects = ['createGoodsDepartment', 'updateGoodsDepartment', 'analysisDepartmentName'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const isForAnalysis = selectId === 'analysisDepartmentName';
                select.innerHTML = '<option value="">Виберіть відділ</option>';

                departments.forEach(dept => {
                    const value = isForAnalysis ? dept.departmentName : dept.id;
                    select.innerHTML += `<option value="${value}">${dept.departmentName}</option>`;
                });
            });
        }

        function populateGoodsIdSelects() {
            const selects = ['goodsId', 'updateGoodsId', 'deleteGoodsId'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Виберіть ID товару</option>';
                allGoods.forEach(goods => {
                    select.innerHTML += `<option value="${goods.id}">${goods.id} - ${goods.productName}</option>`;
                });
            });
        }

        function toggleGoodsTermField(prefix) {
            const isExpiringSelect = document.getElementById(`${prefix}GoodsIsExpiring`);
            const termGroup = document.getElementById(`${prefix}GoodsTermGroup`);
            const termInput = document.getElementById(`${prefix}GoodsTerm`);

            if (isExpiringSelect.value === 'true') {
                termGroup.style.display = 'block';
                termInput.setAttribute('required', true); 
            } else {
                termGroup.style.display = 'none';
                termInput.removeAttribute('required');
                termInput.value = '';
            }
        }

        async function getAllGoods() {
            const spinner = document.getElementById('loadAllGoodsSpinner');
            spinner.style.display = 'inline-block';

            try {
                // Если данные уже загружены для селектов, просто отображаем их
                if (allGoods.length > 0) {
                    displayGoodsGrid(allGoods, 'goodsGrid');
                    updateGoodsStats(allGoods);
                    populateGoodsIdSelects();
                    populateSalesSelects();
                    spinner.style.display = 'none';
                    return;
                }

                // Иначе загружаем как обычно
                const response = await fetch(GOODS_API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allGoods = data;
                    displayGoodsGrid(data, 'goodsGrid');
                    updateGoodsStats(data);
                    populateGoodsIdSelects();
                    populateSalesSelects();
                } else {
                    console.error('Error loading goods:', data);
                    document.getElementById('goodsGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка завантаження товарів</p>';
                }
            } catch (error) {
                console.error('Error loading goods:', error);
                document.getElementById('goodsGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка підключення до сервера</p>';
            } finally {
                spinner.style.display = 'none';
            }
        }

        function displayGoodsGrid(goods, gridId) {
            const grid = document.getElementById(gridId);
            if (goods.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">Товари не знайдені.</p>';
                return;
            }

            grid.innerHTML = goods.map(item => `
                   <div class="employee-card">
                       <h4>${item.productName}</h4>
                       <div class="employee-info">
                           <span>ID:</span>
                           <div class="employee-value">${item.id}</div>
                       </div>
                       <div class="employee-info">
                           <span>Виробник:</span>
                           <div class="employee-value">${item.manufacturer}</div>
                       </div>
                       <div class="employee-info">
                           <span>Відділ:</span>
                           <div class="employee-value">${item.departmentName}</div>
                       </div>
                       <div class="employee-info">
                           <span>Країна:</span>
                           <div class="employee-value">${item.countryName}</div>
                       </div>
                       <div class="employee-info">
                           <span>Температура:</span>
                           <div class="employee-value">${item.temperatureDisplay}</div>
                       </div>
                       <div class="employee-info">
                           <span>Термін придатності:</span>
                           <div class="employee-value">${item.expirationStatus}</div>
                       </div>
                   </div>
               `).join('');
        }

        function updateGoodsStats(goods) {
            if (goods && goods.length > 0) {
                const expiringCount = goods.filter(g => g.is_Expiring).length;
                const avgTemp = goods.reduce((sum, g) => sum + g.conditions_Temperature, 0) / goods.length;

                document.getElementById('totalGoods').textContent = goods.length;
                document.getElementById('expiringGoods').textContent = expiringCount;
                document.getElementById('avgTemperature').textContent = avgTemp.toFixed(1) + '°C';

                document.getElementById('goodsStatsBar').style.display = 'grid';
            }
        }

        async function getGoodsById() {
            const id = document.getElementById('goodsId').value;
            if (!id) {
                showResponse('goodsByIdResponse', 'Будь ласка, виберіть ID товару', true);
                document.getElementById('goodsByIdGrid').innerHTML = '';
                return;
            }

            showLoading('goodsByIdResponse');
            try {
                const response = await fetch(`${GOODS_API_BASE}/${id}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('goodsByIdResponse', `Знайдено товар з ID ${id}`);
                    displayGoodsGrid([data], 'goodsByIdGrid');
                } else {
                    showResponse('goodsByIdResponse', data, true);
                    document.getElementById('goodsByIdGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('goodsByIdResponse', `Помилка: ${error.message}`, true);
                document.getElementById('goodsByIdGrid').innerHTML = '';
            }
        }

        async function getExpiringGoods() {
            showLoading('expiringGoodsResponse');
            try {
                const response = await fetch(`${GOODS_API_BASE}/expiring`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('expiringGoodsResponse', `Знайдено ${data.length} товарів з терміном придатності`);
                    displayGoodsGrid(data, 'expiringGoodsGrid');
                } else {
                    showResponse('expiringGoodsResponse', data, true);
                    document.getElementById('expiringGoodsGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('expiringGoodsResponse', `Помилка: ${error.message}`, true);
                document.getElementById('expiringGoodsGrid').innerHTML = '';
            }
        }

        async function getNonExpiringGoods() {
            showLoading('nonExpiringGoodsResponse');
            try {
                const response = await fetch(`${GOODS_API_BASE}/non-expiring`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('nonExpiringGoodsResponse', `Знайдено ${data.length} товарів без терміну придатності`);
                    displayGoodsGrid(data, 'nonExpiringGoodsGrid');
                } else {
                    showResponse('nonExpiringGoodsResponse', data, true);
                    document.getElementById('nonExpiringGoodsGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('nonExpiringGoodsResponse', `Помилка: ${error.message}`, true);
                document.getElementById('nonExpiringGoodsGrid').innerHTML = '';
            }
        }

        async function getDepartmentAnalysis() {
            const departmentName = document.getElementById('analysisDepartmentName').value;
            if (!departmentName) {
                showResponse('departmentAnalysisResponse', 'Будь ласка, виберіть відділ', true);
                document.getElementById('departmentAnalysisGrid').innerHTML = '';
                return;
            }

            showLoading('departmentAnalysisResponse');
            try {
                const response = await fetch(`${GOODS_API_BASE}/department-analysis/${encodeURIComponent(departmentName)}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('departmentAnalysisResponse', data.summary);

                    const analysisHtml = `
                           <div class="employee-card" style="background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%); color: white;">
                               <h4 style="color: white;">📊 Аналіз відділу "${data.departmentName}"</h4>
                               <div class="employee-info" style="color: rgba(255,255,255,0.9);">
                                   <span style="color: white;">Всього товарів:</span>
                                   <div class="employee-value" style="color: white; font-weight: bold;">${data.productCount}</div>
                               </div>
                               <div class="employee-info" style="color: rgba(255,255,255,0.9);">
                                   <span style="color: white;">З терміном годності:</span>
                                   <div class="employee-value" style="color: white; font-weight: bold;">${data.expiringProductCount}</div>
                               </div>
                               <div class="employee-info" style="color: rgba(255,255,255,0.9);">
                                   <span style="color: white;">Середня температура:</span>
                                   <div class="employee-value" style="color: white; font-weight: bold;">${data.avgStorageTemp.toFixed(1)}°C</div>
                               </div>
                               <div class="employee-info" style="color: rgba(255,255,255,0.9);">
                                   <span style="color: white;">Макс. термін:</span>
                                   <div class="employee-value" style="color: white; font-weight: bold;">${data.maxTermDays || 'Н/Д'} днів</div>
                               </div>
                           </div>
                       `;
                    document.getElementById('departmentAnalysisGrid').innerHTML = analysisHtml;
                } else {
                    showResponse('departmentAnalysisResponse', data, true);
                    document.getElementById('departmentAnalysisGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('departmentAnalysisResponse', `Помилка: ${error.message}`, true);
                document.getElementById('departmentAnalysisGrid').innerHTML = '';
            }
        }

        function parseGoodsTriggerMessage(errorResponse) {
            let message = '';

            if (typeof errorResponse === 'string') {
                message = errorResponse;
            } else if (errorResponse.title || errorResponse.detail || errorResponse.message) {
                message = errorResponse.title || errorResponse.detail || errorResponse.message;
            } else {
                message = JSON.stringify(errorResponse);
            }

            const goodsTriggerMessages = {
                'Temperature must be between -100 and 100 degrees!': '❌ Температура повинна бути від -100 до 100 градусів!',
                'Term must be positive when Is_Expiring is true!': '❌ Термін повинен бути позитивним, коли товар має термін годності!',
                'Term cannot be specified when Is_Expiring is false!': '❌ Термін не може бути вказаний, коли товар не має терміну годності!',
                'The specified department does not exist!': '❌ Вказаний відділ не існує!',
                'The specified country does not exist!': '❌ Вказана країна не існує!'
            };

            for (const [englishMsg, ukrainianMsg] of Object.entries(goodsTriggerMessages)) {
                if (message.includes(englishMsg)) {
                    return ukrainianMsg;
                }
            }

            return `⚠️ Помилка валідації товару: ${message}`;
        }

        async function createGoods() {
            const productName = document.getElementById('createGoodsProductName').value.trim();
            const manufacturer = document.getElementById('createGoodsManufacturer').value.trim();
            const departmentValue = document.getElementById('createGoodsDepartment').value;
            const countryValue = document.getElementById('createGoodsCountry').value;
            const temperatureValue = document.getElementById('createGoodsTemperature').value;
            const isExpiringValue = document.getElementById('createGoodsIsExpiring').value;
            const termValue = document.getElementById('createGoodsTerm').value;

            if (!productName || !manufacturer || !departmentValue || !countryValue ||
                !temperatureValue || !isExpiringValue) {
                showResponse('createGoodsResponse', 'Будь ласка, заповніть всі обов\'язкові поля (позначені *)', true);
                return;
            }

            const department = parseInt(departmentValue);
            const country = parseInt(countryValue);
            const temperature = parseFloat(temperatureValue);
            const isExpiring = isExpiringValue === 'true';
            const term = termValue ? parseInt(termValue) : null;

            if (isNaN(department) || isNaN(country) || isNaN(temperature)) {
                showResponse('createGoodsResponse', 'Помилка: неправильні числові значення в полях', true);
                return;
            }

            const goodsData = {
                productName: productName,
                manufacturer: manufacturer,
                department: department,
                country: country,
                conditions_Temperature: temperature,
                is_Expiring: isExpiring,
                term: isExpiring ? term : null
            };

            showLoading('createGoodsResponse');

            try {
                const response = await fetch(GOODS_API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(goodsData)
                });

                if (response.ok) {
                    const data = await response.json();

                    const originalTerm = goodsData.term;
                    const returnedTerm = data.term;

                    if (isExpiring && !originalTerm && returnedTerm) {
                        showSuccess('createGoodsResponse',
                            `Товар успішно створено! 📅 Термін зберігання був автоматично встановлений на ${returnedTerm} днів згідно з правилами відділу.`);
                    } else {
                        showSuccess('createGoodsResponse', 'Товар успішно створено!');
                    }

                    document.getElementById('createGoodsForm').reset();
                    toggleGoodsTermField('create');

                    // Обновляем список товаров для селектов
                    allGoods = [];
                    await getAllGoods();
                } else {
                    const errorData = await response.json();
                    const translatedMessage = parseGoodsTriggerMessage(errorData);
                    showResponse('createGoodsResponse', translatedMessage, true);
                }
            } catch (error) {
                showResponse('createGoodsResponse', `Помилка підключення: ${error.message}`, true);
            }
        }

        async function loadGoodsForUpdate() {
            const id = document.getElementById('updateGoodsId').value;
            if (!id) {
                showResponse('updateGoodsResponse', 'Будь ласка, виберіть ID товару', true);
                return;
            }

            try {
                const response = await fetch(`${GOODS_API_BASE}/${id}`);
                if (response.ok) {
                    const goods = await response.json();

                    document.getElementById('updateGoodsProductName').value = goods.productName;
                    document.getElementById('updateGoodsManufacturer').value = goods.manufacturer;

                    const department = departments.find(d => d.departmentName === goods.departmentName);
                    document.getElementById('updateGoodsDepartment').value = department ? department.id : '';

                    const country = countries.find(c => c.countryName === goods.countryName);
                    document.getElementById('updateGoodsCountry').value = country ? country.id : '';

                    document.getElementById('updateGoodsTemperature').value = goods.conditions_Temperature;
                    document.getElementById('updateGoodsIsExpiring').value = goods.is_Expiring.toString();
                    document.getElementById('updateGoodsTerm').value = goods.term || '';

                    toggleGoodsTermField('update');

                    document.getElementById('updateGoodsForm').style.display = 'block';
                    showResponse('updateGoodsResponse', 'Дані товару завантажені успішно');
                } else {
                    const error = await response.json();
                    showResponse('updateGoodsResponse', error, true);
                }
            } catch (error) {
                showResponse('updateGoodsResponse', `Помилка: ${error.message}`, true);
            }
        }

        async function updateGoods() {
            const id = document.getElementById('updateGoodsId').value;
            const productName = document.getElementById('updateGoodsProductName').value.trim();
            const manufacturer = document.getElementById('updateGoodsManufacturer').value.trim();
            const departmentValue = document.getElementById('updateGoodsDepartment').value;
            const countryValue = document.getElementById('updateGoodsCountry').value;
            const temperatureValue = document.getElementById('updateGoodsTemperature').value;
            const isExpiringValue = document.getElementById('updateGoodsIsExpiring').value;
            const termValue = document.getElementById('updateGoodsTerm').value;

            if (!productName || !manufacturer || !departmentValue || !countryValue ||
                !temperatureValue || !isExpiringValue) {
                showResponse('updateGoodsResponse', 'Будь ласка, заповніть всі обов\'язкові поля', true);
                return;
            }

            const department = parseInt(departmentValue);
            const country = parseInt(countryValue);
            const temperature = parseFloat(temperatureValue);
            const isExpiring = isExpiringValue === 'true';
            const term = termValue ? parseInt(termValue) : null;

            if (isNaN(department) || isNaN(country) || isNaN(temperature)) {
                showResponse('updateGoodsResponse', 'Помилка: неправильні числові значення в полях', true);
                return;
            }

            const goodsData = {
                productName: productName,
                manufacturer: manufacturer,
                department: department,
                country: country,
                conditions_Temperature: temperature,
                is_Expiring: isExpiring,
                term: isExpiring ? term : null
            };

            showLoading('updateGoodsResponse');

            try {
                const originalTerm = goodsData.term;

                const response = await fetch(`${GOODS_API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(goodsData)
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('updateGoodsForm').style.display = 'none';

                    const returnedTerm = data.term;
                    if (isExpiring && !originalTerm && returnedTerm) {
                        showSuccess('updateGoodsResponse',
                            `Дані товару успішно оновлено! 📅 Термін зберігання був автоматично встановлений на ${returnedTerm} днів згідно з правилами відділу.`);
                    } else {
                        showSuccess('updateGoodsResponse', 'Дані товару успішно оновлено!');
                    }

                    // Обновляем список товаров для селектов
                    allGoods = [];
                    await getAllGoods();
                } else {
                    const errorData = await response.json();
                    const translatedMessage = parseGoodsTriggerMessage(errorData);
                    showResponse('updateGoodsResponse', translatedMessage, true);
                }
            } catch (error) {
                showResponse('updateGoodsResponse', `Помилка підключення: ${error.message}`, true);
            }
        }

        async function deleteGoods() {
            const id = document.getElementById('deleteGoodsId').value;
            if (!id) {
                showResponse('deleteGoodsResponse', 'Будь ласка, виберіть ID товару', true);
                return;
            }

            const goods = allGoods.find(g => g.id == id);
            const goodsName = goods ? goods.productName : `ID ${id}`;

            if (!confirm(`Ви впевнені, що хочете видалити товар "${goodsName}"?`)) {
                return;
            }

            showLoading('deleteGoodsResponse');
            try {
                const response = await fetch(`${GOODS_API_BASE}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showResponse('deleteGoodsResponse', `Товар "${goodsName}" успішно видалено`);
                    document.getElementById('deleteGoodsId').value = '';

                    // Обновляем список товаров для селектов
                    allGoods = [];
                    await getAllGoods();
                } else {
                    const error = await response.json();
                    showResponse('deleteGoodsResponse', error, true);
                }
            } catch (error) {
                showResponse('deleteGoodsResponse', `Помилка: ${error.message}`, true);
            }
        }

        // =================== ПРОДАЖИ ===================

      

        function setMaxSalesDate() {
            const now = new Date();
            const today = now.toISOString().slice(0, 16);

            document.getElementById('createSalesDate').setAttribute('max', today);
            document.getElementById('updateSalesDate').setAttribute('max', today);

            document.getElementById('createSalesDate').value = today;

            const todayDate = now.toISOString().split('T')[0];
            const monthAgo = new Date(now.setMonth(now.getMonth() - 1)).toISOString().split('T')[0];

            document.getElementById('analysisStartDate').value = monthAgo;
            document.getElementById('analysisEndDate').value = todayDate;
            document.getElementById('analysisEndDate').setAttribute('max', todayDate);
        }

        function populateSalesSelects() {
            const employeeSelects = ['createSalesEmployee', 'updateSalesEmployee', 'salesEmployeeId'];
            employeeSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;

                select.innerHTML = '<option value="">Виберіть співробітника</option>';
                allEmployees.forEach(emp => {
                    select.innerHTML += `<option value="${emp.id}">${emp.fullName}</option>`;
                });
            });

            const productSelects = ['createSalesProduct', 'updateSalesProduct', 'salesProductId'];
            productSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;

                select.innerHTML = '<option value="">Виберіть товар</option>';
                allGoods.forEach(goods => {
                    select.innerHTML += `<option value="${goods.id}">${goods.productName} (${goods.departmentName})</option>`;
                });
            });

            const deptSelects = ['procedureDepartmentId', 'workingStatusDepartmentId'];
            deptSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;

                select.innerHTML = '<option value="">Виберіть відділ</option>';
                departments.forEach(dept => {
                    select.innerHTML += `<option value="${dept.id}">${dept.departmentName}</option>`;
                });
            });

            const countrySelect = document.getElementById('procedureCountryId');
            if (countrySelect) {
                countrySelect.innerHTML = '<option value="">Всі країни</option>';
                countries.forEach(country => {
                    countrySelect.innerHTML += `<option value="${country.id}">${country.countryName}</option>`;
                });
            }
        }

        function populateSalesIdSelects() {
            const selects = ['salesId', 'updateSalesId', 'deleteSalesId'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;

                select.innerHTML = '<option value="">Виберіть ID продажу</option>';
                allSales.forEach(sale => {
                    const shortInfo = `${sale.employeeName} - ${sale.productName}`;
                    select.innerHTML += `<option value="${sale.id}">${sale.id} - ${shortInfo}</option>`;
                });
            });
        }

        function parseSalesTriggerMessage(errorResponse) {
            let message = '';

            if (typeof errorResponse === 'string') {
                message = errorResponse;
            } else if (errorResponse.title || errorResponse.detail || errorResponse.message) {
                message = errorResponse.title || errorResponse.detail || errorResponse.message;
            } else {
                message = JSON.stringify(errorResponse);
            }

            const salesTriggerMessages = {
                'Quantity of sold products must be greater than zero!': '❌ Кількість проданих товарів повинна бути більше нуля!',
                'Product price must be greater than zero!': '❌ Ціна товару повинна бути більше нуля!',
                'Sale date cannot be in the future!': '❌ Дата продажу не може бути в майбутньому!',
                'Referenced employee does not exist!': '❌ Вказаний співробітник не існує!',
                'Referenced product does not exist!': '❌ Вказаний товар не існує!',
                'Employee can only sell products from their own department!': '❌ Співробітник може продавати тільки товари зі свого відділу!',
                'Product price must be between 0.01 and 999999.99!': '❌ Ціна товару повинна бути від 0.01 до 999999.99!',
                'Quantity cannot exceed 10000 units per sale!': '❌ Кількість не може перевищувати 10000 одиниць за продаж!'
            };

            for (const [englishMsg, ukrainianMsg] of Object.entries(salesTriggerMessages)) {
                if (message.includes(englishMsg)) {
                    return ukrainianMsg;
                }
            }

            return `⚠️ Помилка валідації продажу: ${message}`;
        }

        function displaySalesGrid(sales, gridId) {
            const grid = document.getElementById(gridId);
            if (sales.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">Продажі не знайдені.</p>';
                return;
            }


            grid.innerHTML = sales.map(sale => {
                const dateOnly = new Date(sale.date).toLocaleDateString('uk-UA');

                const product = allGoods.find(goods => goods.productName === sale.productName);
                const productDepartment = product ? product.departmentName : 'Невідомий відділ';

                return `
       <div class="sales-card">
           <h4>Продаж #${sale.id}</h4>
           <div class="sales-info">
               <span>Співробітник:</span>
               <div class="sales-value">${sale.employeeFullName}</div>
           </div>
           <div class="sales-info">
               <span>Товар:</span>
               <div class="sales-value">${sale.productName}</div>
           </div>
          <div class="sales-info">
               <span>Відділ товару:</span>
               <div class="sales-value">${productDepartment}</div>
           </div>
           <div class="sales-info">
               <span>Дата:</span>
               <div class="sales-value sales-date">${dateOnly}</div>
           </div>
           <div class="sales-info">
               <span>Кількість:</span>
               <div class="sales-value">${sale.formattedQuantity}</div>
           </div>
           <div class="sales-info">
               <span>Ціна:</span>
               <div class="sales-value">${sale.formattedPrice}</div>
           </div>
           <div class="sales-info">
               <span>Сума:</span>
               <div class="sales-value sales-amount">${sale.formattedTotal}</div>
           </div>
       </div>
   `}).join('');
        }

        function updateSalesStats(sales) {
            if (sales && sales.length > 0) {
                const totalAmount = sales.reduce((sum, sale) => sum + sale.total, 0);
                const avgAmount = totalAmount / sales.length;

                document.getElementById('totalSales').textContent = sales.length;
                document.getElementById('totalSalesAmount').textContent = totalAmount.toLocaleString('uk-UA', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }) + ' грн';
                document.getElementById('avgSaleAmount').textContent = avgAmount.toLocaleString('uk-UA', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }) + ' грн';

                document.getElementById('salesStatsBar').style.display = 'grid';
            }
        }

        function calculateSalesTotal(prefix) {
            const quantityInput = document.getElementById(`${prefix}SalesQuantity`);
            const priceInput = document.getElementById(`${prefix}SalesPrice`);
            const totalSpan = document.getElementById(`${prefix}SalesTotalAmount`);

            const quantity = parseFloat(quantityInput.value) || 0;
            const price = parseFloat(priceInput.value) || 0;
            const total = quantity * price;

            totalSpan.textContent = total.toLocaleString('uk-UA', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }) + ' грн';
        }

        document.addEventListener('DOMContentLoaded', function () {
            const createQuantity = document.getElementById('createSalesQuantity');
            const createPrice = document.getElementById('createSalesPrice');
            if (createQuantity && createPrice) {
                createQuantity.addEventListener('input', () => calculateSalesTotal('create'));
                createPrice.addEventListener('input', () => calculateSalesTotal('create'));
            }

            const updateQuantity = document.getElementById('updateSalesQuantity');
            const updatePrice = document.getElementById('updateSalesPrice');
            if (updateQuantity && updatePrice) {
                updateQuantity.addEventListener('input', () => calculateSalesTotal('update'));
                updatePrice.addEventListener('input', () => calculateSalesTotal('update'));
            }
        });

        async function getAllSales() {
            const spinner = document.getElementById('loadAllSalesSpinner');
            spinner.style.display = 'inline-block';

            try {
                // Если данные уже загружены для селектов, просто отображаем их
                if (allSales.length > 0) {
                    displaySalesGrid(allSales, 'salesGrid');
                    updateSalesStats(allSales);
                    populateSalesIdSelects();
                    spinner.style.display = 'none';
                    return;
                }

                // Иначе загружаем как обычно
                const response = await fetch(SALES_API_BASE); // 🔽 ЗАБЫТА ЗАКРЫВАЮЩАЯ СКОБКА И ТОЧКА С ЗАПЯТОЙ
                const data = await response.json(); // 🔽 ЗАБЫТО ПОЛУЧЕНИЕ ДАННЫХ

                if (response.ok) {
                    allSales = data;
                    displaySalesGrid(data, 'salesGrid');
                    updateSalesStats(data);
                    populateSalesIdSelects();
                } else {
                    console.error('Error loading sales:', data);
                    document.getElementById('salesGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка завантаження продажів</p>';
                }
            } catch (error) {
                console.error('Error loading sales:', error);
                document.getElementById('salesGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка підключення до сервера</p>';
            } finally {
                spinner.style.display = 'none';
            }
        }

        // Загрузка продаж только для селектов (без отображения в сетке)
        //async function loadSalesForSelects() {
        //    if (allSales.length > 0) return; // Уже загружены

        //    try {
        //        const response = await fetch(SALES_API_BASE);
        //        const data = await response.json();

        //        if (response.ok) {
        //            allSales = data;
        //            populateSalesIdSelects();
        //            console.log(`Загружено ${data.length} продаж для селектов`);
        //        }
        //    } catch (error) {
        //        console.error('Error loading sales for selects:', error);
        //    }
        //}
        async function getSalesById() {
            const id = document.getElementById('salesId').value;
            if (!id) {
                showResponse('salesByIdResponse', 'Будь ласка, виберіть ID продажу', true);
                document.getElementById('salesByIdGrid').innerHTML = '';
                return;
            }

            showLoading('salesByIdResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/${id}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('salesByIdResponse', `Знайдено продаж з ID ${id}`);
                    displaySalesGrid([data], 'salesByIdGrid');
                } else {
                    showResponse('salesByIdResponse', data, true);
                    document.getElementById('salesByIdGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('salesByIdResponse', `Помилка: ${error.message}`, true);
                document.getElementById('salesByIdGrid').innerHTML = '';
            }
        }

        async function getSalesByEmployee() {
            const employeeId = document.getElementById('salesEmployeeId').value;
            if (!employeeId) {
                showResponse('salesByEmployeeResponse', 'Будь ласка, виберіть співробітника', true);
                document.getElementById('salesByEmployeeGrid').innerHTML = '';
                return;
            }

            showLoading('salesByEmployeeResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/employee/${employeeId}`);
                const data = await response.json();

                if (response.ok) {
                    const employee = allEmployees.find(emp => emp.id == employeeId);
                    const employeeName = employee ? employee.fullName : 'вибраний співробітник';

                    showResponse('salesByEmployeeResponse', `Знайдено ${data.length} продажів для співробітника ${employeeName}`);
                    displaySalesGrid(data, 'salesByEmployeeGrid');
                } else {
                    showResponse('salesByEmployeeResponse', data, true);
                    document.getElementById('salesByEmployeeGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('salesByEmployeeResponse', `Помилка: ${error.message}`, true);
                document.getElementById('salesByEmployeeGrid').innerHTML = '';
            }
        }

        async function getSalesByProduct() {
            const productId = document.getElementById('salesProductId').value;
            if (!productId) {
                showResponse('salesByProductResponse', 'Будь ласка, виберіть товар', true);
                document.getElementById('salesByProductGrid').innerHTML = '';
                return;
            }

            showLoading('salesByProductResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/product/${productId}`);
                const data = await response.json();

                if (response.ok) {
                    const product = allGoods.find(goods => goods.id == productId);
                    const productName = product ? product.productName : 'вибраний товар';

                    showResponse('salesByProductResponse', `Знайдено ${data.length} продажів для товару "${productName}"`);
                    displaySalesGrid(data, 'salesByProductGrid');
                } else {
                    showResponse('salesByProductResponse', data, true);
                    document.getElementById('salesByProductGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('salesByProductResponse', `Помилка: ${error.message}`, true);
                document.getElementById('salesByProductGrid').innerHTML = '';
            }
        }

        async function getEmployeeSalesAnalysis() {
            showLoading('employeeSalesAnalysisResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/analysis/employees`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('employeeSalesAnalysisResponse', `Аналіз продажів для ${data.length} співробітників`);

                    const analysisHtml = data.map(analysis => `
               <div class="analysis-card">
                   <h4>${analysis.employeeName}</h4>
                   <div class="sales-info">
                       <span>Відділ:</span>
                       <div class="sales-value">${analysis.departmentName}</div>
                   </div>
                   <div class="sales-info">
                       <span>Кількість продажів:</span>
                       <div class="sales-value">${analysis.totalSales}</div>
                   </div>
                   <div class="sales-info">
                       <span>Загальна кількість:</span>
                       <div class="sales-value">${analysis.formattedTotalQuantity}</div>
                   </div>
                   <div class="sales-info">
                       <span>Загальна сума:</span>
                       <div class="sales-value sales-amount">${analysis.formattedTotalAmount}</div>
                   </div>
                   <div class="sales-info">
                       <span>Середня ціна:</span>
                       <div class="sales-value">${analysis.formattedAveragePrice}</div>
                   </div>
               </div>
           `).join('');

                    document.getElementById('employeeSalesAnalysisGrid').innerHTML = analysisHtml;
                } else {
                    showResponse('employeeSalesAnalysisResponse', data, true);
                    document.getElementById('employeeSalesAnalysisGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('employeeSalesAnalysisResponse', `Помилка: ${error.message}`, true);
                document.getElementById('employeeSalesAnalysisGrid').innerHTML = '';
            }
        }

        async function getSalesByPeriod() {
            const startDate = document.getElementById('analysisStartDate').value;
            const endDate = document.getElementById('analysisEndDate').value;

            if (!startDate || !endDate) {
                showResponse('salesPeriodAnalysisResponse', 'Будь ласка, виберіть дати початку та закінчення', true);
                document.getElementById('salesPeriodAnalysisGrid').innerHTML = '';
                return;
            }

            if (new Date(startDate) > new Date(endDate)) {
                showResponse('salesPeriodAnalysisResponse', 'Дата початку не може бути пізніше дати закінчення', true);
                document.getElementById('salesPeriodAnalysisGrid').innerHTML = '';
                return;
            }

            showLoading('salesPeriodAnalysisResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/analysis/period?startDate=${startDate}&endDate=${endDate}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('salesPeriodAnalysisResponse', `Аналіз продажів за період з ${startDate} по ${endDate}`);

                    const analysisHtml = data.map(analysis => `
               <div class="analysis-card">
                   <h4>📅 ${analysis.formattedDate}</h4>
                   <div class="sales-info">
                       <span>Кількість продажів:</span>
                       <div class="sales-value">${analysis.totalSales}</div>
                   </div>
                   <div class="sales-info">
                       <span>Загальна кількість:</span>
                       <div class="sales-value">${analysis.formattedTotalQuantity}</div>
                   </div>
                   <div class="sales-info">
                       <span>Загальна сума:</span>
                       <div class="sales-value sales-amount">${analysis.formattedTotalAmount}</div>
                   </div>
               </div>
           `).join('');

                    document.getElementById('salesPeriodAnalysisGrid').innerHTML = analysisHtml;
                } else {
                    showResponse('salesPeriodAnalysisResponse', data, true);
                    document.getElementById('salesPeriodAnalysisGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('salesPeriodAnalysisResponse', `Помилка: ${error.message}`, true);
                document.getElementById('salesPeriodAnalysisGrid').innerHTML = '';
            }
        }

        async function createSales() {
            const employeeValue = document.getElementById('createSalesEmployee').value;
            const productValue = document.getElementById('createSalesProduct').value;
            const dateValue = document.getElementById('createSalesDate').value;
            const quantityValue = document.getElementById('createSalesQuantity').value;
            const priceValue = document.getElementById('createSalesPrice').value;

            if (!employeeValue || !productValue || !dateValue || !quantityValue || !priceValue) {
                showResponse('createSalesResponse', 'Будь ласка, заповніть всі обов\'язкові поля (позначені *)', true);
                return;
            }

            const employee = parseInt(employeeValue);
            const product = parseInt(productValue);
            const quantity = parseFloat(quantityValue);
            const price = parseFloat(priceValue);

            if (isNaN(employee) || isNaN(product) || isNaN(quantity) || isNaN(price)) {
                showResponse('createSalesResponse', 'Помилка: неправильні числові значення в полях', true);
                return;
            }

            const salesData = {
                employee: employee,
                product: product,
                date: dateValue,
                quantity: quantity,
                price: price
            };

            showLoading('createSalesResponse');

            try {
                const response = await fetch(SALES_API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(salesData)
                });

                if (response.ok) {
                    const data = await response.json();
                    showSuccess('createSalesResponse', `Продаж успішно створено! Загальна сума: ${data.formattedTotal}`);
                    document.getElementById('createSalesForm').reset();
                    calculateSalesTotal('create');
                    setMaxSalesDate();

                    // Обновляем список продаж для селектов
                    allSales = [];
                    await getAllSales();
                } else {
                    const errorData = await response.json();
                    const translatedMessage = parseSalesTriggerMessage(errorData);
                    showResponse('createSalesResponse', translatedMessage, true);
                }
            } catch (error) {
                showResponse('createSalesResponse', `Помилка підключення: ${error.message}`, true);
            }
        }

        async function loadSalesForUpdate() {
            const id = document.getElementById('updateSalesId').value;
            if (!id) {
                showResponse('updateSalesResponse', 'Будь ласка, виберіть ID продажу', true);
                return;
            }

            try {
                const response = await fetch(`${SALES_API_BASE}/${id}`);
                if (response.ok) {
                    const sales = await response.json();

                    const employee = allEmployees.find(emp => emp.fullName === sales.employeeFullName);
                    const product = allGoods.find(goods => goods.productName === sales.productName);

                    document.getElementById('updateSalesEmployee').value = employee ? employee.id : '';
                    document.getElementById('updateSalesProduct').value = product ? product.id : '';

                    const saleDate = new Date(sales.date);
                    const formattedDate = saleDate.toISOString().slice(0, 16);
                    document.getElementById('updateSalesDate').value = formattedDate;

                    document.getElementById('updateSalesQuantity').value = sales.quantity;
                    document.getElementById('updateSalesPrice').value = sales.price;

                    calculateSalesTotal('update');

                    document.getElementById('updateSalesForm').style.display = 'block';
                    showResponse('updateSalesResponse', 'Дані продажу завантажені успішно');
                } else {
                    const error = await response.json();
                    showResponse('updateSalesResponse', error, true);
                }
            } catch (error) {
                showResponse('updateSalesResponse', `Помилка: ${error.message}`, true);
            }
        }

        async function updateSales() {
            const id = document.getElementById('updateSalesId').value;
            const employeeValue = document.getElementById('updateSalesEmployee').value;
            const productValue = document.getElementById('updateSalesProduct').value;
            const dateValue = document.getElementById('updateSalesDate').value;
            const quantityValue = document.getElementById('updateSalesQuantity').value;
            const priceValue = document.getElementById('updateSalesPrice').value;

            if (!employeeValue || !productValue || !dateValue || !quantityValue || !priceValue) {
                showResponse('updateSalesResponse', 'Будь ласка, заповніть всі обов\'язкові поля', true);
                return;
            }

            const employee = parseInt(employeeValue);
            const product = parseInt(productValue);
            const quantity = parseFloat(quantityValue);
            const price = parseFloat(priceValue);

            if (isNaN(employee) || isNaN(product) || isNaN(quantity) || isNaN(price)) {
                showResponse('updateSalesResponse', 'Помилка: неправильні числові значення в полях', true);
                return;
            }

            const salesData = {
                employee: employee,
                product: product,
                date: dateValue,
                quantity: quantity,
                price: price
            };

            showLoading('updateSalesResponse');

            try {
                const response = await fetch(`${SALES_API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(salesData)
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('updateSalesForm').style.display = 'none';
                    showSuccess('updateSalesResponse', `Дані продажу успішно оновлено! Нова сума: ${data.formattedTotal}`);

                    // Обновляем список продаж для селектов
                    allSales = [];
                    await getAllSales();
                } else {
                    const errorData = await response.json();
                    const translatedMessage = parseSalesTriggerMessage(errorData);
                    showResponse('updateSalesResponse', translatedMessage, true);
                }
            } catch (error) {
                showResponse('updateSalesResponse', `Помилка підключення: ${error.message}`, true);
            }
        }

        async function deleteSales() {
            const id = document.getElementById('deleteSalesId').value;
            if (!id) {
                showResponse('deleteSalesResponse', 'Будь ласка, виберіть ID продажу', true);
                return;
            }

            const sales = allSales.find(s => s.id == id);
            const salesInfo = sales ? `${sales.employeeName} - ${sales.productName}` : `ID ${id}`;

            if (!confirm(`Ви впевнені, що хочете видалити продаж "${salesInfo}"?`)) {
                return;
            }

            showLoading('deleteSalesResponse');
            try {
                const response = await fetch(`${SALES_API_BASE}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showResponse('deleteSalesResponse', `Продаж "${salesInfo}" успішно видалено`);
                    document.getElementById('deleteSalesId').value = '';

                    // Обновляем список продаж для селектов
                    allSales = [];
                    await getAllSales();
                } else {
                    const error = await response.json();
                    showResponse('deleteSalesResponse', error, true);
                }
            } catch (error) {
                showResponse('deleteSalesResponse', `Помилка: ${error.message}`, true);
            }
        }

        async function getProductsByDepartmentAndCountry() {
            const departmentId = document.getElementById('procedureDepartmentId').value;
            const countryId = document.getElementById('procedureCountryId').value;

            if (!departmentId) {
                showResponse('procedureProductsResponse', 'Будь ласка, виберіть відділ', true);
                document.getElementById('procedureProductsGrid').innerHTML = '';
                return;
            }

            showLoading('procedureProductsResponse');

            try {
                let url = `${SALES_API_BASE}/products/department/${departmentId}`;
                if (countryId) {
                    url += `?countryId=${countryId}`;
                }

                const response = await fetch(url);
                const data = await response.json();

                if (response.ok) {
                    const department = departments.find(d => d.id == departmentId);
                    const country = countryId ? countries.find(c => c.id == countryId) : null;
                    const departmentName = department ? department.departmentName : 'вибраний відділ';
                    const countryName = country ? ` з країни ${country.countryName}` : '';

                    showResponse('procedureProductsResponse',
                        `Знайдено ${data.length} товарів у відділі "${departmentName}"${countryName}`);
                    displayGoodsGrid(data, 'procedureProductsGrid');
                } else {
                    showResponse('procedureProductsResponse', data, true);
                    document.getElementById('procedureProductsGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('procedureProductsResponse', `Помилка: ${error.message}`, true);
                document.getElementById('procedureProductsGrid').innerHTML = '';
            }
        }

        async function checkDepartmentWorkingStatus() {
            const departmentId = document.getElementById('workingStatusDepartmentId').value;
            const checkTime = document.getElementById('checkTime').value;

            if (!departmentId || !checkTime) {
                showResponse('workingStatusResponse', 'Будь ласка, виберіть відділ та час', true);
                document.getElementById('workingStatusGrid').innerHTML = '';
                return;
            }

            showLoading('workingStatusResponse');

            try {
                const response = await fetch(`${SALES_API_BASE}/department/${departmentId}/working-status?checkTime=${checkTime}`);
                const data = await response.json();

                if (response.ok) {
                    showResponse('workingStatusResponse', `Перевірка статусу роботи відділу на ${checkTime}`);

                    const statusHtml = `
               <div class="procedure-card">
                   <h4>🏢 ${data.departmentName}</h4>
                   <div class="sales-info">
                       <span>Час відкриття:</span>
                       <div class="sales-value">${data.openingTime}</div>
                   </div>
                   <div class="sales-info">
                       <span>Час закриття:</span>
                       <div class="sales-value">${data.closingTime}</div>
                   </div>
                   <div class="sales-info">
                       <span>Перевіряємий час:</span>
                       <div class="sales-value">${data.checkedTime}</div>
                   </div>
                   <div class="working-status ${data.isWorking ? 'working' : 'not-working'}">
                       ${data.workingStatus === 'Department works' ? '✅ Відділ працює' : '❌ Відділ не працює'}
                   </div>
               </div>
           `;

                    document.getElementById('workingStatusGrid').innerHTML = statusHtml;
                } else {
                    showResponse('workingStatusResponse', data, true);
                    document.getElementById('workingStatusGrid').innerHTML = '';
                }
            } catch (error) {
                showResponse('workingStatusResponse', `Помилка: ${error.message}`, true);
                document.getElementById('workingStatusGrid').innerHTML = '';
            }
        }

        // =================== ОТДЕЛЫ ===================

     

        function displayDepartmentsGrid(departments, gridId) {
            const grid = document.getElementById(gridId);
            if (departments.length === 0) {
                grid.innerHTML = '<p style="text-align: center; padding: 20px; color: #718096;">Відділи не знайдені.</p>';
                return;
            }

            console.log('Displaying departments:', departments);

            grid.innerHTML = departments.map(dept => `
       <div class="employee-card" style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);">
           <h4>${dept.departmentName}</h4>
           <div class="employee-info">
               <span>ID:</span>
               <div class="employee-value">${dept.id}</div>
           </div>
           <div class="employee-info">
               <span>Ряд:</span>
               <div class="employee-value">${dept.locationRow}</div>
           </div>
           <div class="employee-info">
               <span>Торговий:</span>
               <div class="employee-value">${dept.salesStatus}</div>
           </div>
           <div class="employee-info">
               <span>Прилавки:</span>
               <div class="employee-value">${dept.counters}</div>
           </div>
           <div class="employee-info">
               <span>Час роботи:</span>
               <div class="employee-value">${dept.workingHours}</div>
           </div>
       </div>
   `).join('');
        }

        function populateDepartmentSelectForUpdate() {
            const select = document.getElementById('updateDepartmentId');
            select.innerHTML = '<option value="">Виберіть відділ</option>';
            allDepartments.forEach(dept => {
                select.innerHTML += `<option value="${dept.id}">${dept.departmentName} (Ряд ${dept.locationRow})</option>`;
            });
        }

        async function getAllDepartments() {
            const spinner = document.getElementById('loadAllDepartmentsSpinner');
            spinner.style.display = 'inline-block';

            try {
                const response = await fetch(DEPARTMENTS_API_BASE);
                const data = await response.json();

                if (response.ok) {
                    allDepartments = data;
                    displayDepartmentsGrid(data, 'departmentsGrid');
                    populateDepartmentSelectForUpdate();
                } else {
                    console.error('Error loading departments:', data);
                    document.getElementById('departmentsGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка завантаження відділів</p>';
                }
            } catch (error) {
                console.error('Error loading departments:', error);
                document.getElementById('departmentsGrid').innerHTML = '<p style="text-align: center; padding: 20px; color: #e53e3e;">Помилка підключення до сервера</p>';
            } finally {
                spinner.style.display = 'none';
            }
        }

        async function loadDepartmentForUpdate() {
            const id = document.getElementById('updateDepartmentId').value;
            if (!id) {
                showResponse('updateDepartmentResponse', 'Будь ласка, виберіть відділ', true);
                return;
            }

            try {
                const response = await fetch(`${DEPARTMENTS_API_BASE}/${id}`);
                if (response.ok) {
                    const department = await response.json();

                    document.getElementById('updateDeptName').value = department.departmentName;
                    document.getElementById('updateLocationRow').value = department.locationRow;
                    document.getElementById('updateSales').value = department.sales.toString();
                    document.getElementById('updateCounters').value = department.counters;
                    document.getElementById('updateStartTime').value = department.formattedStartTime;
                    document.getElementById('updateEndTime').value = department.formattedEndTime;

                    document.getElementById('updateDepartmentForm').style.display = 'block';
                    showResponse('updateDepartmentResponse', 'Дані відділу завантажені успішно');
                } else {
                    const error = await response.json();
                    showResponse('updateDepartmentResponse', error, true);
                }
            } catch (error) {
                showResponse('updateDepartmentResponse', `Помилка: ${error.message}`, true);
            }
        }

        async function updateDepartment() {
            const id = document.getElementById('updateDepartmentId').value;
            const departmentData = {
                departmentName: document.getElementById('updateDeptName').value.trim(),
                locationRow: parseInt(document.getElementById('updateLocationRow').value),
                sales: document.getElementById('updateSales').value === 'true',
                counters: parseInt(document.getElementById('updateCounters').value),
                startTime: document.getElementById('updateStartTime').value + ':00',
                endTime: document.getElementById('updateEndTime').value + ':00'
            };

            if (!departmentData.departmentName) {
                showResponse('updateDepartmentResponse', 'Назва відділу є обов\'язковою', true);
                return;
            }

            if (isNaN(departmentData.locationRow) || departmentData.locationRow < 0) {
                showResponse('updateDepartmentResponse', 'Номер ряду повинен бути не менше 0', true);
                return;
            }

            if (isNaN(departmentData.counters) || departmentData.counters < 0) {
                showResponse('updateDepartmentResponse', 'Кількість прилавків повинна бути не менше 0', true);
                return;
            }

            if (departmentData.startTime >= departmentData.endTime) {
                showResponse('updateDepartmentResponse', 'Час відкриття повинен бути раніше часу закриття', true);
                return;
            }

            showLoading('updateDepartmentResponse');

            try {
                const response = await fetch(`${DEPARTMENTS_API_BASE}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(departmentData)
                });

                if (response.ok) {
                    const data = await response.json();
                    await getAllDepartments();
                    document.getElementById('updateDepartmentForm').style.display = 'none';
                    showSuccess('updateDepartmentResponse', `Відділ "${data.departmentName}" успішно оновлено!`);
                } else {
                    const errorData = await response.json();
                    showResponse('updateDepartmentResponse', errorData, true);
                }
            } catch (error) {
                showResponse('updateDepartmentResponse', `Помилка підключення: ${error.message}`, true);
            }
        }
        function populateDepartmentSelectForUpdate() {
            const select = document.getElementById('updateDepartmentId');
            if (!select) return;

            select.innerHTML = '<option value="">Виберіть відділ</option>';
            allDepartments.forEach(dept => {
                select.innerHTML += `<option value="${dept.id}">${dept.departmentName} (Ряд ${dept.locationRow})</option>`;
            });
        }
    </script>
</body>
</html>